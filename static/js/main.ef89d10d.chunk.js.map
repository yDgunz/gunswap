{"version":3,"sources":["simulator/Toss.ts","simulator/SiteswapRegex.ts","simulator/Prop.ts","simulator/Siteswap.ts","simulator/TossPath.ts","simulator/Bezier.ts","simulator/JugglerConfig.ts","simulator/Pattern.ts","simulator/DwellPathSnapshot.ts","simulator/DwellPath.ts","search/Edge.ts","search/Search.ts","search/Node.ts","ui/PatternSettings.tsx","search/RandomPattern.ts","ui/JugglingScene.ts","ui/Viewport.tsx","ui/Search.tsx","ui/Animator.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["Hand","BounceType","TossType","CatchType","validToss","validMultiplex","validThrow","validSync","validBeat","validPass","ValidTossRe","RegExp","ValidMultiplexRe","ValidThrowRe","ValidSyncRe","ValidBeatRe","ValidPassRe","ValidSiteswapRe","ValidPassShorthandRe","PropType","defaultTossOrientation","vec3","normalize","Toss","siteswap","juggler","hand","dwellPath","numJugglers","defaultDwellRatio","numSurfaces","Object","classCallCheck","this","Juggler","TargetJuggler","Crossing","NumBeats","Siteswap","NumBounces","BounceOrder","NumSpins","DwellPath","DwellRatio","TossOrientation","RotationAxis","Hold","tossMatches","match","length","charCodeAt","parseInt","isPass","pIx","indexOf","dIx","parseFloat","substring","bounceIdentifierIx","bounceParamsIx","slice","search","undefined","i","isNaN","surfaceIx","push","numMissingBounces","HyperForce","HyperLift","Force","Lift","Any","tIx","Standard","tossTypeId","Claw","Penguin","cIx","catchTypeId","Right","Left","sIx","spinConfig","Math","floor","siteswapInput","_this","Beats","IsSync","IsMultiplex","IsPassingPattern","NumJugglers","replace","test","passingBeats","split","Error","forEach","beat","validPassShorthandMatch","SiteswapRegex","transformPassingShorthand","charAt","transformSymmetricSyncShorthand","siteswapMatch","beats","x","splice","createClass","key","value","newSiteswapStr","jugglerSiteswaps","jugglerBeats","j","pairs","reverse","join","dwellPaths","tossCollection","beatIx","dwellPathIx","singleBeatTossCollection","jugglerToss","jugglerIx","jugglerTosses","handTosses","splitToss","toss","handToss","propToss","Prop","Id","C","Radius","TossSchedule","Beat","GetTossPathPositionAndVelocity","curToss","nextToss","currentTime","totalTime","tossJugglerBodyPosition","tossJugglerBodyRotation","catchJugglerBodyPosition","catchJugglerBodyRotation","startPosition","GetPosition","endPosition","y","z","InterpolateBezierSpline","t","v_0","v_T","v_0scale","v_Tscale","matchVelocity","dwellPosition","C0","copy","add","scale","C1","c","interpolatedPath","c1","p0","p1","c0","c1prev","m0","m1","l0","sqrt","pow","_t","q","dwellPositionIx","BasePatternHeight","Pattern","DwellPaths","Props","TossCollection","States","Simulation","GetTossCollection","sumOfAllTosses","map","patterns","substr","sumThrows","numProps","Ball","maxHeight","propsQueue","curState","k","patternComplete","initComplete","propsLanding","landingLeft","shift","prop","landingRight","tossHand","catchHand","propToToss","propLandingIx","propLanding","concat","JSON","stringify","pop","parse","str","total","numStepsPerBeat","beatDuration","_this2","breakOnCollision","arguments","totalNumBeats","numSteps","hasCollision","patternSimulation","Jugglers","BeatDuration","NumStepsPerBeat","Positions","Rotations","jugglers","bodyPosition","bodyRotation","PI","sin","cos","BodyPositions","Array","fill","BodyRotations","LeftHandPositions","RightHandPositions","LeftElbowPositions","RightElbowPositions","LeftHandDirections","RightHandDirections","step","currentBeat","propIx","prevToss","_prop$GetPreviousCurr","GetPreviousCurrentAndNextTossForBeat","_prop$GetPreviousCurr2","slicedToArray","virtualCurrentTime","prevTossVirtualBeat","nextTossVirtualBeat","curTossVirtualBeat","tossTime","catchTime","prevTossTime","prevCatchTime","prevTossJugglerBodyPosition","prevTossJugglerBodyRotation","prevTossFlightTime","catchVelocity","tossVelocity","pos","Snapshots","handDirection","pos1","pos2","dist","distance","handNextToss","handLastToss","handNextTossVirtualBeat","scheduledToss","scheduledTossVirtualBeat","handPos","handLastTossVirtualBeat","catchingPropLastToss","tossedPropNextToss","emptyHandPath","Position","scheduledTossIx","tossSchedule","jugglerBodyPosition","jugglerBodyRotation","tossedPropCatchingJugglerBodyPosition","tossedPropCatchingJugglerBodyRotation","catchingPropTossJugglerBodyPosition","catchingPropTossJugglerBodyRotation","totalEmptyHandTime","rot","shoulderPosition","elbowPosition","getElbowPosition","handPosition","armAngle","armHalfLength","Hp","Hpp","th","atan2","magHp","u1","u2","h","Epp","Ep","E","highestPoint","lowestPoint","p","DefaultBallRotation","vec4","DwellPathSnapshot","input","empty","defaultRotation","Rotation","Empty","xyzMatch","xyz","rotationValues","dwellPathSnapshotRe","heldDwellPathSnapshots","emptyDwellPathSnapshots","startVelocity","endVelocity","startVelocityScale","endVelocityScale","additionalPathSnapshot","splinePath","a","adjustDwellPathSnapshotByHandAndJuggler","positionCopy","GetDwellPaths","ix","arr","GetEdgeValue","source","target","edgeValue","nextUp","LandingSchedule","newNodeLandingSchedule","multiplex","tossValue","tossValueString","toString","String","fromCharCode","last","FindSiteswaps","config","nodes","maxPeriod","includeMultiplex","options","buildNodes","node","reduce","b","nodeOption","nodeOptions","newNode","Edges","propDiff","GetNodes","MaxPeriod","NumProps","IncludeMultiplex","edges","SourceNode","TargetNode","Value","GetEdges","numSearches","siteswaps","formattedSiteswaps","origNodeIx","history","MaxSearches","MaxSiteswaps","nextNodeIx","validSiteswap","siteswapStartNode","MinPeriod","Sync","IncludeExcited","syncEdgeValue","asyncEdgeValue","exists","ssToMatch","patternsMatch","formattedSiteswap","edgeIx","exclude","Exclude","newHistory","p2","defaultPatternSettings","dwellRatio","PatternSettingsControls","_Component","props","possibleConstructorReturn","getPrototypeOf","call","state","Yaml","errorMessage","showSyntaxHelp","updatePatternSettingsInput","bind","assertThisInitialized","juggleRandomPattern","juggleInputPattern","juggle","inherits","e","setState","patternSettings","pattern","Simulate","updatePattern","message","round","random","dwellPathXPositions","dwellPathYPositions","dwellPathPositions","findRandomPattern","s","d","FindRandomPattern","react_default","createElement","Stack","MessageBar","messageBarType","MessageBarType","info","Link","href","severeWarning","isMultiline","horizontal","PrimaryButton","className","text","onClick","DefaultButton","Label","TextField","multiline","onChange","autoAdjustHeight","Component","JugglerMeshMaterial","THREE","color","JugglingScene","container","width","height","animationSpeed","scene","camera","renderer","propMeshes","jugglerMeshes","camRadius","camPhi","camTheta","startTime","isMouseDown","onMouseDownPosition","onMouseDownTheta","onMouseDownPhi","positionToLookAt","currentStep","userControllingStep","isPlaying","antialias","Date","getTime","UpdatePattern","setSize","domElement","addEventListener","event","onDocumentMouseMove","onDocumentMouseDown","onDocumentMouseUp","onDocumentMouseWheel","onDocumentTouchMove","onDocumentTouchStart","onDocumentTouchEnd","append","animate","patternProgress","highestLowest","GetHeighestAndLowestPositionInSimulation","updateCamera","aspect","updateProjectionMatrix","clientX","clientY","touches","newCamPhi","preventDefault","onMove","deltaY","position","lookAt","patternTimeElapsed","meshToRemove","remove","geometry","material","propMesh","mesh","set","addJugglerMeshes","meshes","jugglerPositions","BodyMesh","ShoulderHeight","vec3ToTHREEVector3","HeadMesh","leftShoulderPosition","rightShoulderPosition","leftHandPosition","rightHandPosition","leftElbowPosition","rightElbowPosition","LeftHandMesh","RightHandMesh","LeftElbowMesh","RightElbowMesh","LeftShoulderMesh","RightShoulderMesh","positionAndRotateArm","LeftBicepMesh","LeftForearmMesh","LeftWristMesh","RightBicepMesh","RightForearmMesh","RightWristMesh","rotation","setFromUnitVectors","setRotationFromQuaternion","requestAnimationFrame","render","bicepMesh","forearmMesh","wristMesh","armDirection","subVectors","arrow","clone","setFromVector3","toVector3","newPosition","addVectors","multiplyScalar","side","flatShading","radius","radius1","radius2","cylinder","getHandMesh","getJointMesh","getArmCylinder","ArmHalfLength","Viewport","CanvasContainerRef","jugglingScene","debugInfo","userUpdateStep","play","pause","sliderValue","UpdateStep","offsetWidth","window","innerHeight","Resize","playbackButton","_this3","debug","IconButton","iconProps","iconName","ref","DOMNodeRef","Slider","min","max","showValue","Search","Siteswaps","Input","onRenderCell","findSiteswaps","updateInput","item","index","id","List","items","Animator","onresize","forceUpdate","PatternSettings_PatternSettingsControls","Search_Search","viewport","ui_Viewport","innerWidth","dir","Pivot","PivotItem","headerText","itemIcon","initializeIcons","App","ui_Animator","Boolean","location","hostname","ReactDOM","src_App_0","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.ef89d10d.chunk.js","sourcesContent":["import { DwellPath } from \"./DwellPath\";\r\nimport { vec3 } from \"@tlaukkan/tsm\";\r\nimport { ValidTossRe } from \"./SiteswapRegex\";\r\n\r\nexport enum Hand {\r\n\tLeft = 0,\r\n\tRight = 1,\r\n\tAny = 2\r\n}\r\n\r\nexport enum BounceType {\r\n    Force,\r\n    HyperForce,\r\n    Lift,\r\n\tHyperLift,\r\n\tAny\r\n}\r\n\r\nexport enum TossType {\r\n    Standard,\r\n    Claw,\r\n    Penguin\r\n}\r\n\r\nexport enum CatchType {\r\n    Standard,\r\n    Claw,\r\n    Penguin\r\n}\r\n\r\nconst defaultTossOrientation = new vec3([.1,.1,1]).normalize();\r\n\r\nexport class Toss {\r\n\t\r\n\tpublic readonly Juggler: number;\r\n\tpublic readonly TargetJuggler: number;\r\n\tpublic readonly Hand: Hand;\r\n\tpublic readonly Crossing: boolean;\r\n\tpublic readonly NumBeats: number;\r\n\tpublic readonly Siteswap: string;\r\n\tpublic readonly NumBounces: number;\r\n\tpublic readonly BounceOrder: number[];\r\n\tpublic readonly BounceType?: BounceType;\r\n\tpublic readonly NumSpins: number;\r\n\tpublic readonly DwellPath : DwellPath;\r\n\tpublic readonly DwellRatio : number;\r\n\tpublic readonly TossType : TossType\r\n\tpublic readonly CatchType : CatchType;\r\n\tpublic readonly TossOrientation : vec3;\r\n\tpublic readonly RotationAxis : vec3;\r\n\tpublic readonly Hold : boolean;\r\n\t\r\n\tconstructor(siteswap : string, juggler : number, hand : Hand, dwellPath : DwellPath, numJugglers : number, defaultDwellRatio : number, numSurfaces: number) {\r\n\t\tthis.Juggler = juggler;\r\n\t\tthis.Hand = hand;\r\n\t\tthis.Siteswap = siteswap;\r\n\t\tthis.DwellPath = dwellPath;\r\n\r\n\t\tvar tossMatches = siteswap.match(ValidTossRe);\r\n\t\tif (!tossMatches || tossMatches.length > 1) {\r\n\t\t\tthrow \"Invalid toss string\"\r\n\t\t} else {\r\n\t\t\t/* will work from \"a\" to \"o\" */\r\n\t\t\tthis.NumBeats = (siteswap[0].charCodeAt(0) >= 97 && siteswap[0].charCodeAt(0) <= 119) ? siteswap[0].charCodeAt(0)-87 : parseInt(siteswap[0]);\r\n\t\t\t\r\n\t\t\t// by default the target juggler is the tossing juggler\r\n\t\t\tthis.TargetJuggler = juggler;\r\n\t\t\tvar isPass = false;\r\n\t\t\tvar pIx = siteswap.indexOf(\"P\");\t\t\t\r\n\t\t\tif (\r\n\t\t\t\tpIx > 0 &&\r\n\t\t\t\tsiteswap[pIx+1] != \"}\" // check that the next character isn't a }, in which case this is a catch/toss penguin modifier\r\n\t\t\t) {\t\t\t\t\r\n\t\t\t\tif (numJugglers > 2) {\t\t\t\t\t\r\n\t\t\t\t\tthis.TargetJuggler = parseInt(siteswap[pIx+1])-1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.TargetJuggler = 1 - juggler;\r\n\t\t\t\t}\r\n\t\t\t\tisPass = true;\r\n\t\t\t}\r\n\r\n\t\t\tvar dIx = siteswap.indexOf(\"D\");\r\n\t\t\tif (dIx > 0) {\r\n\t\t\t\tthis.DwellRatio = parseFloat(siteswap.substring(dIx+2,siteswap.indexOf(\"}\")));\r\n\t\t\t} else {\r\n\t\t\t\tthis.DwellRatio = defaultDwellRatio;\r\n\t\t\t}\r\n\r\n\t\t\tthis.NumBounces = 0;\r\n\t\t\tthis.BounceOrder = [];\r\n\t\t\tvar bounceIdentifierIx = siteswap.indexOf(\"B\");\r\n\t\t\tif (bounceIdentifierIx > 0) {\r\n\t\t\t\tvar bounceParamsIx = siteswap.slice(bounceIdentifierIx).search(/\\d/) + bounceIdentifierIx; // find index of next number indicating # bounces and bounce order\r\n\t\t\t\tif (siteswap[bounceIdentifierIx+1] == \"{\" && bounceParamsIx != undefined) {\r\n\t\t\t\t\tthis.NumBounces = parseInt(siteswap[bounceParamsIx]);\r\n\t\t\t\t\tfor (var i = bounceParamsIx + 1; i < siteswap.length; i++) {\r\n\t\t\t\t\t\tif (!isNaN(siteswap[i] as any)) {\r\n\t\t\t\t\t\t\tvar surfaceIx = parseInt(siteswap[i]);\r\n\t\t\t\t\t\t\tif (surfaceIx >= numSurfaces) {\r\n\t\t\t\t\t\t\t\tthrow \"Bounce surface index out of range\";\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.BounceOrder.push(surfaceIx);\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.NumBounces = 1;\r\n\t\t\t\t\tthis.BounceOrder = [0];\r\n\t\t\t\t}\r\n\t\t\t\tif (this.BounceOrder.length < this.NumBounces) {\r\n\t\t\t\t\tvar numMissingBounces = this.NumBounces - this.BounceOrder.length;\r\n\t\t\t\t\tfor (var i = 0; i < numMissingBounces; i++) {\r\n\t\t\t\t\t\tthis.BounceOrder.push(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (this.NumBounces > 0) {\r\n\t\t\tif (siteswap.match(\"HF\")) {\r\n\t\t\t\tthis.BounceType = BounceType.HyperForce;\r\n\t\t\t} else if (siteswap.match(\"HL\")) {\r\n\t\t\t\tthis.BounceType = BounceType.HyperLift;\r\n\t\t\t} else if (siteswap.match(\"F\")) {\r\n\t\t\t\tthis.BounceType = BounceType.Force;\r\n\t\t\t} else if (siteswap.match(\"L\")) {\r\n\t\t\t\tthis.BounceType = BounceType.Lift;\r\n\t\t\t} else {\r\n\t\t\t\tthis.BounceType = BounceType.Any;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar tIx = siteswap.indexOf(\"T\");\r\n\t\tthis.TossType = TossType.Standard;\r\n\t\tif (tIx > 0) {\r\n\t\t\tvar tossTypeId = siteswap.substring(tIx+2,siteswap.indexOf('}',tIx));\r\n\t\t\tif (tossTypeId.match(\"C\")) {\r\n\t\t\t\tthis.TossType = TossType.Claw;\r\n\t\t\t} else if (tossTypeId.match(\"P\")) {\r\n\t\t\t\tthis.TossType = TossType.Penguin;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar cIx = siteswap.indexOf(\"C\");\r\n\t\tthis.CatchType = CatchType.Standard;\r\n\t\tif (cIx > 0) {\r\n\t\t\tvar catchTypeId = siteswap.substring(cIx+2,siteswap.indexOf('}',cIx));\r\n\t\t\tif (catchTypeId.match(\"C\")) {\r\n\t\t\t\tthis.CatchType = CatchType.Claw;\r\n\t\t\t} else if (catchTypeId.match(\"P\")) {\r\n\t\t\t\tthis.CatchType = CatchType.Penguin;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.Crossing = this.NumBeats % 2 == 1;\r\n\t\t// if the second character is an \"x\" then crossing is flipped\r\n\t\tif (siteswap.length > 1 && siteswap[1] == \"x\") {\r\n\t\t\tthis.Crossing = !this.Crossing;\r\n\t\t}\r\n\r\n\t\t// TODO - can the animator actually support this?\r\n\t\tif (siteswap[0] == \"R\") {\r\n\t\t\tthis.Hand = Hand.Right;\r\n\t\t} else if (siteswap[0] == \"L\") {\r\n\t\t\tthis.Hand = Hand.Left;\r\n\t\t}\r\n\r\n\t\tthis.TossOrientation = defaultTossOrientation;\r\n\t\tvar sIx = siteswap.indexOf(\"S\");\t\t\t\r\n\t\tif (sIx > 0) {\t\t\t\r\n\t\t\tvar spinConfig = siteswap.substring(sIx+2,siteswap.indexOf('}',sIx)).match(/-?\\d+(\\.\\d+)?/g);\r\n\t\t\tif (spinConfig) {\r\n\t\t\t\tthis.NumSpins = parseFloat(spinConfig[0]);\r\n\t\t\t\tif (spinConfig.length > 1) {\r\n\t\t\t\t\tthis.TossOrientation = new vec3([\r\n\t\t\t\t\t\tparseFloat(spinConfig[1]),\r\n\t\t\t\t\t\tparseFloat(spinConfig[2]),\r\n\t\t\t\t\t\tparseFloat(spinConfig[3])\r\n\t\t\t\t\t]).normalize();\t\t\t\t\t\r\n\t\t\t\t} \r\n\t\t\t} else {\r\n\t\t\t\tthrow \"Invalid spin configuration\";\r\n\t\t\t}\t\t\r\n\t\t} else {\t\t\t\t\t\r\n\t\t\tthis.NumSpins = Math.floor(this.NumBeats/2) + .2;\r\n\t\t\t// passes get an extra bit of spin\r\n\t\t\tif (isPass) {\r\n\t\t\t\tthis.NumSpins += .1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.Hold = this.NumBeats == 2 && !this.Crossing && siteswap.indexOf(\"A\") == -1;\r\n\t\tthis.RotationAxis = new vec3([1,0,0]);\r\n\r\n    }    \r\n}","// construct the various regex patterns. see blog post for details about this\r\nvar validToss = \"([\\\\da-o])x?A?(P\\\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\\\d*(L|HL|F|HF)?\\\\d*})?)?(S{-?\\\\d+(.\\\\d+)?(,-?\\\\d+(.\\\\d+)?,-?\\\\d+(.\\\\d+)?,-?\\\\d+(.\\\\d+)?)?})?(D{\\\\d*\\\\.?\\\\d*})?\";\r\nvar validMultiplex = \"\\\\[(\" + validToss + \")+\\\\]\";\r\nvar validThrow = validToss + \"|\" + validMultiplex;\r\nvar validSync = \"\\\\((\" + validThrow + \"),(\" + validThrow + \")\\\\)\";\r\nvar validBeat = \"(\" + validThrow + \"|\" + validSync + \")\";\r\nvar validPass = \"<\" + validBeat + \"(\\\\|\" + validBeat + \")+>\";\r\nvar validSiteswap = \"^(\" + validPass + \")+|(\" + validBeat + \")+\\\\*?$\";\r\n\r\n// use this to identify passing pattern shorthand like <3P333|3P333>\r\n// we will then convert those patterns to standard notation like <3P|3P><3|3><3|3><3|3> \r\n// and parse them as we did before\r\nvar validPassShorthand = \"<\" + validBeat + \"+(\\\\|\" + validBeat + \"+)+>\"; \r\n\r\nexport const ValidTossRe = new RegExp(validToss,\"g\");\r\nexport const ValidMultiplexRe = new RegExp(validMultiplex,\"g\");\r\nexport const ValidThrowRe = new RegExp(validThrow,\"g\");\r\nexport const ValidSyncRe = new RegExp(validSync,\"g\");\r\nexport const ValidBeatRe = new RegExp(validBeat,\"g\");\r\nexport const ValidPassRe = new RegExp(validPass,\"g\");\r\nexport const ValidSiteswapRe = new RegExp(validSiteswap,\"g\");\r\nexport const ValidPassShorthandRe = new RegExp(validPassShorthand,\"g\");","import { Toss, Hand } from \"./Toss\";\r\n\r\nexport enum PropType {\r\n\tBall,\r\n\tClub,\r\n\tRing\r\n}\r\n\r\nexport class Prop {\t\r\n\t\r\n\tTossSchedule : ScheduledToss[]\r\n\r\n\tconstructor(public readonly Id : number, public readonly PropType : PropType, public readonly C : number, public readonly Radius : number) {\r\n\t\tthis.TossSchedule = [];\r\n\t}\r\n\r\n\tpublic GetPreviousCurrentAndNextTossForBeat(beat : number) : [ScheduledToss,ScheduledToss,ScheduledToss] {\r\n\t\tfor (var i = 0; i < this.TossSchedule.length; i++) {\r\n\t\t\tif (i == this.TossSchedule.length-1 || this.TossSchedule[i].Beat <= beat && this.TossSchedule[i+1].Beat > beat) {\r\n\t\t\t\t\r\n\t\t\t\tvar prevToss : ScheduledToss;\r\n\t\t\t\tif (i == 0) {\r\n\t\t\t\t\tprevToss = this.TossSchedule[this.TossSchedule.length-1];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tprevToss = this.TossSchedule[i-1];\r\n\t\t\t\t}\r\n\t\t\t\tvar curToss : ScheduledToss = this.TossSchedule[i];\r\n\t\t\t\tvar nextToss : ScheduledToss;\r\n\t\t\t\tif (i == this.TossSchedule.length-1) {\r\n\t\t\t\t\tnextToss = this.TossSchedule[0];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnextToss = this.TossSchedule[i+1];\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn [prevToss, curToss, nextToss];\r\n\r\n\t\t\t} \r\n\t\t}\r\n\t\tthrow \"Unable to determine previous, current, and next toss for beat\";\r\n\t} \r\n\r\n}\r\n\r\nexport interface ScheduledToss {\r\n\treadonly Beat : number;\r\n\treadonly Hand : Hand;\r\n\treadonly Toss : Toss;\r\n}","import * as SiteswapRegex from \"./SiteswapRegex\";\r\nimport { DwellPath } from \"./DwellPath\";\r\nimport { Toss, Hand } from \"./Toss\";\r\n\r\nexport class Siteswap {\r\n    \r\n    public readonly Siteswap : string;\r\n\tpublic readonly Beats : string[];\r\n\tpublic readonly IsSync : boolean;\r\n\tpublic readonly IsMultiplex : boolean;\t\r\n\tpublic readonly IsPassingPattern : boolean;\r\n\tpublic readonly NumJugglers : number;\r\n\r\n    constructor(siteswapInput: string) {\r\n        this.Siteswap = siteswapInput.replace(/\\s/g,\"\");\r\n        this.NumJugglers = 1;\r\n        this.IsPassingPattern = /<[^ ]+>/.test(this.Siteswap);\r\n        \r\n        if (this.IsPassingPattern) {\r\n\t\t\tvar passingBeats = this.Siteswap.match(/<[^ <>]+>/g);\r\n\t\t\tif (passingBeats) {\r\n\t\t\t\tthis.NumJugglers = passingBeats[0].split(\"|\").length;\r\n\r\n\t\t\t\t/* \r\n\t\t\t\t\tcheck to make sure each beat in the passing pattern has the same number of jugglers \r\n\t\t\t\t\tif a passing pattern only has 1 juggler than it's automatically a mismatch\r\n\t\t\t\t*/\r\n\t\t\t\tif(this.NumJugglers == 1) {\r\n\t\t\t\t\tthrow new Error(\"Cannot have passing pattern with 1 juggler.\");\r\n\t\t\t\t};\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t// ensure all beats have the same number of jugglers\r\n\t\t\t\tpassingBeats.forEach(beat => {\r\n\t\t\t\t\tif (beat.split(\"|\").length != this.NumJugglers) {\r\n\t\t\t\t\t\tthrow new Error(\"Each beat in passing siteswap must contain same number of jugglers\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\r\n\t\t// if the input string was shorthand for a passing pattern\r\n\t\t// then replace the siteswap string with a fully formed passing pattern\r\n\t\t// ie. transform <33|33> to <3|3><3|3>\r\n\t\tvar validPassShorthandMatch = this.Siteswap.match(SiteswapRegex.ValidPassShorthandRe);\r\n\t\tif (validPassShorthandMatch != null && validPassShorthandMatch[0] == this.Siteswap) {\r\n\t\t\tthis.Siteswap = this.transformPassingShorthand();\r\n\t\t}\r\n\r\n\t\t// if the input string was a synchronous siteswap ending in *\r\n\t\t// then we repeat the input pattern, but swap the throws in each pair\r\n\t\t// to make the pattern symmetric\r\n\t\t// e.g. transform (6x,4)* to (6x,4)(4,6x)\r\n\t\tif (this.Siteswap.charAt(this.Siteswap.length-1) == \"*\") {\r\n\t\t\tthis.Siteswap = this.transformSymmetricSyncShorthand();\r\n\t\t}\r\n\r\n\t\tvar siteswapMatch = this.Siteswap.match(SiteswapRegex.ValidSiteswapRe);\r\n\t\tif (siteswapMatch !== null && siteswapMatch[0] === this.Siteswap) {\t\t\t\r\n\t\t\tthis.IsMultiplex = this.Siteswap.match(SiteswapRegex.ValidMultiplexRe) ? true : false;\r\n\t\t\tthis.IsSync = this.Siteswap.match(SiteswapRegex.ValidSyncRe) ? true : false;\r\n\t\t} else {\r\n\t\t\tthrow \"Invalid siteswap syntax.\";\r\n\t\t} \r\n\r\n\t\t// break the siteswap into individual beats\r\n\t\tvar beats = this.IsPassingPattern ? this.Siteswap.match(SiteswapRegex.ValidPassRe) : this.Siteswap.match(SiteswapRegex.ValidBeatRe);\r\n\t\tthis.Beats = [];\r\n\t\tif (beats) {\t\t\t\r\n\t\t\tbeats.forEach(x => {this.Beats.push(x)});\r\n\t\t}\r\n\r\n\t\t// add (0,0) after each synchronous throw - this prevents the halving issue\r\n\t\tfor(var i = 0; i < this.Beats.length; i++) {\r\n\t\t\tif (this.Beats[i].match(SiteswapRegex.ValidSyncRe)) {\r\n\t\t\t\tthis.Beats.splice(i+1,0,'(0,0)');\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n    }    \r\n\t\r\n\tprivate transformPassingShorthand() : string {\r\n        var newSiteswapStr = \"\";\r\n\t\tvar jugglerSiteswaps = this.Siteswap.split('|');\r\n\t\tvar jugglerBeats = [];\r\n\t\tfor(var i = 0; i < jugglerSiteswaps.length; i++) {\r\n\t\t\tjugglerBeats.push(jugglerSiteswaps[i].match(SiteswapRegex.ValidBeatRe));\r\n\t\t}\t\t\r\n\t\tfor (var i = 0; i < jugglerBeats[0]!.length; i++) {\r\n\t\t\tnewSiteswapStr += \"<\";\r\n\t\t\tfor (var j = 0; j < jugglerBeats.length; j++) {\r\n\t\t\t\tnewSiteswapStr += jugglerBeats[j]![i];\r\n\t\t\t\tif (j < jugglerBeats.length - 1) {\r\n\t\t\t\t\tnewSiteswapStr += \"|\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tnewSiteswapStr += \">\";\r\n\t\t}\r\n\t\treturn newSiteswapStr;\r\n\t}\r\n\t\r\n\tprivate transformSymmetricSyncShorthand() : string {\r\n\t\tvar newSiteswapStr = this.Siteswap.slice(0,-1);\r\n\t\tvar pairs = newSiteswapStr.match(SiteswapRegex.ValidSyncRe);\r\n\t\tif (pairs !== null) {\r\n\t\t\tfor (var i = 0; i < pairs.length; i++) {\r\n\t\t\t\tnewSiteswapStr += \"(\" + pairs[i].match(SiteswapRegex.ValidThrowRe)!.reverse().join(\",\") + \")\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn newSiteswapStr\r\n\t}\r\n\r\n\tpublic GetTossCollection(dwellPaths : DwellPath[], defaultDwellRatio : number, numSurfaces : number) : Toss[][] {\r\n\t\tvar tossCollection:Toss[][] = [];\r\n\r\n\t\t// for each beat get the tosses\r\n\t\tvar beatIx = 0;\r\n\t\tvar dwellPathIx = 0;\r\n\t\tdo {\r\n\t\t\r\n\t\t\tvar beat = this.Beats[beatIx];\r\n\t\t\tbeatIx++;\r\n\t\t\tif (beatIx == this.Beats.length) {\r\n\t\t\t\tbeatIx = 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar singleBeatTossCollection:Toss[] = [];\r\n\r\n\t\t\tvar jugglerTosses;\r\n\t\t\tif (beat.match(SiteswapRegex.ValidPassRe)) {\r\n\t\t\t\tjugglerTosses = beat.match(SiteswapRegex.ValidBeatRe);\r\n\t\t\t} else {\r\n\t\t\t\tjugglerTosses = [beat];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tjugglerTosses!.forEach((jugglerToss, jugglerIx, jugglerTosses) => {\r\n\t\t\t\tvar handTosses = [];\r\n\t\t\t\tif (jugglerToss.match(SiteswapRegex.ValidSyncRe)) {\r\n\t\t\t\t\tvar splitToss = jugglerToss.split(\",\");\t\r\n\t\t\t\t\thandTosses.push({hand: Hand.Left, toss: splitToss[0]});\r\n\t\t\t\t\thandTosses.push({hand: Hand.Right, toss: splitToss[1]});\r\n\t\t\t\t} else {\r\n\t\t\t\t\thandTosses.push({hand: Hand.Any, toss: jugglerToss})\r\n\t\t\t\t}\r\n\r\n\t\t\t\thandTosses.forEach(handToss => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar dwellPath = dwellPaths[dwellPathIx];\r\n\t\t\t\t\tdwellPathIx++;\r\n\t\t\t\t\tif (dwellPathIx == dwellPaths.length) {\r\n\t\t\t\t\t\tdwellPathIx = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar propTosses = handToss.toss.match(SiteswapRegex.ValidTossRe);\r\n\t\t\t\t\t\r\n\t\t\t\t\tpropTosses!.forEach(propToss => {\r\n\t\t\t\t\t\tvar toss = new Toss(\r\n\t\t\t\t\t\t\tpropToss,\r\n\t\t\t\t\t\t\tjugglerIx, \r\n\t\t\t\t\t\t\thandToss.hand,\r\n\t\t\t\t\t\t\tdwellPath,\r\n\t\t\t\t\t\t\tjugglerTosses.length,\r\n\t\t\t\t\t\t\tdefaultDwellRatio,\r\n\t\t\t\t\t\t\tnumSurfaces\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tsingleBeatTossCollection.push(toss);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// don't use up a dwell path on a 0 throw\r\n\t\t\t\t\t\tif (toss.NumBeats == 0) {\r\n\t\t\t\t\t\t\tdwellPathIx--; \r\n\t\t\t\t\t\t\tif (dwellPathIx < 0) {\r\n\t\t\t\t\t\t\t\tdwellPathIx = dwellPaths.length-1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\t\t\t\t\t\t\r\n\t\t\t\t\t});\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\ttossCollection.push(singleBeatTossCollection);\r\n\t\t} while (!(beatIx == 0 && dwellPathIx == 0))\r\n\r\n\t\treturn tossCollection;\r\n\r\n\t}\r\n\r\n}","import { ScheduledToss } from \"./Prop\";\r\nimport { vec3 } from \"@tlaukkan/tsm\";\r\n\r\nexport function GetTossPathPositionAndVelocity(\r\n\tcurToss : ScheduledToss, \r\n\tnextToss: ScheduledToss, \r\n\tcurrentTime: number, \r\n\ttotalTime: number,\r\n\ttossJugglerBodyPosition : vec3,\r\n\ttossJugglerBodyRotation : number,\r\n\tcatchJugglerBodyPosition : vec3,\r\n\tcatchJugglerBodyRotation : number\r\n) : [vec3,vec3] {\r\n\t// figure out flight path\r\n\tvar startPosition = curToss.Toss.DwellPath.GetPosition(1, curToss.Hand, new vec3(), new vec3(), 0, 0, null, tossJugglerBodyPosition, tossJugglerBodyRotation);\r\n\tvar endPosition = nextToss.Toss.DwellPath.GetPosition(0, nextToss.Hand, new vec3(), new vec3(), 0, 0, null, catchJugglerBodyPosition, catchJugglerBodyRotation);\r\n\r\n\treturn [\r\n\t\tnew vec3([\r\n\t\t\tstartPosition.x + (endPosition.x-startPosition.x)*currentTime/totalTime,\r\n\t\t\tstartPosition.y + (endPosition.y - startPosition.y + .5*9.8*totalTime*totalTime)*currentTime/totalTime - .5*9.8*currentTime*currentTime,\r\n\t\t\tstartPosition.z + (endPosition.z-startPosition.z)*currentTime/totalTime\r\n\t\t]),\r\n\t\tnew vec3([\r\n\t\t\t(endPosition.x-startPosition.x)/totalTime,\r\n\t\t\t(endPosition.y - startPosition.y +.5*9.8*totalTime*totalTime)/totalTime - 9.8*currentTime,\r\n\t\t\t(endPosition.z-startPosition.z)/totalTime\r\n\t\t])\r\n\t];\r\n\t\r\n}","import { vec3 } from \"@tlaukkan/tsm\";\r\nimport { DwellPath } from \"./DwellPath\";\r\n\r\nexport function InterpolateBezierSpline(\r\n\tdwellPath : vec3[],\r\n\tt : number, // from 0 to 1, how far to interpolate\r\n\tv_0 : vec3,\r\n\tv_T : vec3,\r\n\tv_0scale : number,\r\n\tv_Tscale : number,\r\n\tmatchVelocity : boolean\r\n) : vec3 {\r\n\r\n\tvar dwellPosition : vec3;\r\n\r\n\tif (t == 0) {\r\n\t\tdwellPosition = dwellPath[0];\r\n\t} else if (t == 1) {\r\n\t\tdwellPosition = dwellPath[dwellPath.length-1];\r\n\t} else {\r\n\r\n\t\t/* if P is just one point, duplicate it */\r\n\t\tif (dwellPath.length == 1) {\r\n\t\t\tdwellPath.push(dwellPath[0]);\r\n\t\t}\t\t\t\r\n\r\n\t\tvar C0 = dwellPath[0].copy();\r\n\t\tC0.add(v_0.copy().scale(v_0scale));\t// factor in how much the velocity impacts the path \r\n\t\tC0.add(v_0.copy().normalize().scale(0.1)); // make sure to consider the direction of the velocity regardless of the v_0scale\r\n\r\n\t\tvar C1 = dwellPath[dwellPath.length-1].copy();\r\n\t\tC1.add(v_T.copy().scale(-v_Tscale));\r\n\t\tC1.add(v_T.copy().normalize().scale(-0.1));\r\n\r\n\t\tvar C = [C0,C1];\r\n\t\t\t\r\n\t\tvar eps = .00001;\r\n\r\n\t\tvar c : vec3[] = [];\r\n\t\tvar interpolatedPath = [];\r\n\r\n\t\tfor (var i = 0; i < dwellPath.length-1; i++) {\r\n\t\t\tvar p0 = dwellPath[i];\r\n\t\t\tvar p1 = dwellPath[i+1];\r\n\r\n\t\t\tvar c0 : vec3, c1 : vec3;\r\n\r\n\t\t\tif (i == 0) {\r\n\t\t\t\tc0 = C[0];\r\n\t\t\t} else {\r\n\t\t\t\tvar c1prev = c[c.length-1];\r\n\t\t\t\tvar c0 = new vec3([p0.x + (p0.x - c1prev.x), p0.y + (p0.y - c1prev.y), p0.z + (p0.z - c1prev.z)]);\r\n\t\t\t\tc.push(c0);\r\n\t\t\t}\r\n\r\n\t\t\tif (i+1 == dwellPath.length-1) {\r\n\t\t\t\tc1 = C[1];\r\n\t\t\t} else {\r\n\t\t\t\tvar m0 = new vec3([(dwellPath[i].x+dwellPath[i+1].x)/2, (dwellPath[i].y+dwellPath[i+1].y)/2, (dwellPath[i].z+dwellPath[i+1].z)/2]);\r\n\t\t\t\tvar m1 = new vec3([(dwellPath[i+1].x+dwellPath[i+2].x)/2, (dwellPath[i+1].y+dwellPath[i+2].y)/2, (dwellPath[i+1].z+dwellPath[i+2].z)/2]);\r\n\t\t\t\tvar l0 = Math.sqrt( Math.pow(dwellPath[i].x - dwellPath[i+1].x,2) + Math.pow(dwellPath[i].y - dwellPath[i+1].y,2) + Math.pow(dwellPath[i].z - dwellPath[i+1].z,2) );\r\n\t\t\t\tvar l1 = Math.sqrt( Math.pow(dwellPath[i+1].x - dwellPath[i+2].x,2) + Math.pow(dwellPath[i+1].y - dwellPath[i+2].y,2) + Math.pow(dwellPath[i+1].z - dwellPath[i+2].z,2) );\r\n\t\t\t\tvar _t = l0/(l0+l1);\r\n\t\t\t\tvar q = new vec3([(1-_t)*m0.x + _t*m1.x, (1-_t)*m0.y + _t*m1.y, (1-_t)*m0.z + _t*m1.z]);\r\n\t\t\t\tc1 = new vec3([p1.x + (m0.x-q.x), p1.y + (m0.y-q.y), p1.z + (m0.z-q.z)]);\r\n\t\t\t\tc.push(c1);\r\n\t\t\t}\r\n\r\n\t\t\tfor (var _t = 0; _t <= 1+eps; _t += .02) {\r\n\t\t\t\tinterpolatedPath.push(\r\n\t\t\t\t\tnew vec3([\r\n\t\t\t\t\t\tMath.pow(1-_t,3)*p0.x + 3*Math.pow(1-_t,2)*_t*c0.x + 3*(1-_t)*Math.pow(_t,2)*c1.x + Math.pow(_t,3)*p1.x,\r\n\t\t\t\t\t\tMath.pow(1-_t,3)*p0.y + 3*Math.pow(1-_t,2)*_t*c0.y + 3*(1-_t)*Math.pow(_t,2)*c1.y + Math.pow(_t,3)*p1.y,\r\n\t\t\t\t\t\tMath.pow(1-_t,3)*p0.z + 3*Math.pow(1-_t,2)*_t*c0.z + 3*(1-_t)*Math.pow(_t,2)*c1.z + Math.pow(_t,3)*p1.z\r\n\t\t\t\t\t])\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// TODO - implement velocity matching feature\r\n\t\t\t\t/*\r\n\t\t\t\tif (interpolatedPath.length == 1) {\r\n\t\t\t\t\tinterpolatedPath.last().dist = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinterpolatedPath.last().dist = interpolatedPath[interpolatedPath.length-2].dist + Math.sqrt(Math.pow(interpolatedPath.last().x-interpolatedPath[interpolatedPath.length-2].x,2)+Math.pow(interpolatedPath.last().y-interpolatedPath[interpolatedPath.length-2].y,2)+Math.pow(interpolatedPath.last().z-interpolatedPath[interpolatedPath.length-2].z,2));\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar dwellPositionIx = Math.floor(t*interpolatedPath.length);\r\n\t\t\r\n\t\tdwellPosition = interpolatedPath[dwellPositionIx < 0 ? 0 : dwellPositionIx];\t\t\r\n\t}\r\n\r\n\treturn dwellPosition;\r\n\r\n}","export const ShoulderZOffset : number = .25;\r\nexport const ShoulderXOffset : number = .225;\r\nexport const ShoulderHeight : number = 1.425;\r\nexport const ArmHalfLength : number = .3;\r\nexport const BasePatternHeight : number = 1.05;\r\nexport const ArmAngle : number = .2;","import { Siteswap as SiteswapClass } from \"./Siteswap\";\r\nimport { DwellPath } from \"./DwellPath\";\r\nimport * as SiteswapRegex from \"./SiteswapRegex\";\r\nimport { Prop, PropType, ScheduledToss } from \"./Prop\";\r\nimport { Toss, Hand } from \"./Toss\";\r\nimport { PatternSimulation } from \"./PatternSimulation\";\r\nimport { vec3 } from \"@tlaukkan/tsm\";\r\nimport { GetTossPathPositionAndVelocity } from \"./TossPath\";\r\nimport { InterpolateBezierSpline } from \"./Bezier\";\r\nimport { ShoulderZOffset, ShoulderHeight, ArmHalfLength, ShoulderXOffset, BasePatternHeight, ArmAngle } from \"./JugglerConfig\";\r\n\r\nexport interface PropLanding {\r\n\tProp : Prop,\r\n\tJuggler : number,\r\n\tHand : Hand\r\n}\r\n\r\nexport class Pattern {\t\r\n\r\n\tpublic readonly Props : Prop[];\r\n\tpublic readonly TossCollection : Toss[][];\r\n\tpublic readonly States : (Prop[]|null)[][][][]; // States[referenceBeat][juggler][hand][beat] contains a Prop[] of the props scheduled to land at beat as of the referenceBeat\r\n\tpublic Simulation : PatternSimulation|undefined;\r\n\r\n\tconstructor(public readonly Siteswap : SiteswapClass, public readonly DwellPaths : DwellPath[], defaultDwellRatio : number, numSurfaces : number) {\r\n\t\t\r\n\t\t// TODO: move GetTossCollection to this class\r\n\t\tthis.TossCollection = Siteswap.GetTossCollection(DwellPaths, defaultDwellRatio, numSurfaces);\r\n\r\n\t\t/* figure out how many props */\r\n\t\tvar sumOfAllTosses = 0;\r\n\t\tvar _this = this;\r\n\t\tSiteswap.Beats.map(function(beat) {\r\n\t\t\tif (beat.match(SiteswapRegex.ValidPassRe)) {\r\n\t\t\t\tvar patterns = beat.split('|');\r\n\t\t\t\tfor (var i = 0; i < patterns.length; i++) {\r\n\t\t\t\t\tif (i == 0) {\r\n\t\t\t\t\t\tpatterns[i] = patterns[i].substr(1);\r\n\t\t\t\t\t} \r\n\t\t\t\t\tif (i == patterns.length-1) {\r\n\t\t\t\t\t\tpatterns[i] = patterns[i].substr(0,patterns[i].length-1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsumOfAllTosses += _this.sumThrows(patterns[i]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tsumOfAllTosses += _this.sumThrows(beat);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif((sumOfAllTosses/Siteswap.Beats.length % 1) == 0 && sumOfAllTosses/Siteswap.Beats.length > 0) {\r\n\t\t\tvar numProps = sumOfAllTosses/Siteswap.Beats.length;\r\n\t\t} else {\t\t\r\n\t\t\tthrow \"Cannot determine number of props\";\r\n\t\t}\r\n\r\n\t\t// TODO: update this to use prop templates from constructor\r\n\t\tthis.Props = [];\r\n\t\tfor(let i = 0; i < numProps; i++) {\r\n\t\t\tthis.Props.push(new Prop(i,PropType.Ball, 0.5, 0.1));\r\n\t\t}\t\t\r\n\r\n\t\t/* figure out the max throw height which will inform the size of the state array */\r\n\t\tvar maxHeight = 0;\r\n\r\n\t\tthis.TossCollection.forEach(x => {\r\n\t\t\tx.forEach(y => {\r\n\t\t\t\tif (y.NumBeats > maxHeight) {\r\n\t\t\t\t\tmaxHeight = y.NumBeats;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\t/* ------------------------------------ */\r\n\t\t/* GENERATE STATE ARRAY AND PROP ORBITS */\r\n\t\t/* ------------------------------------ */\r\n\t\t\r\n\t\t/* create a queue of props */\r\n\t\tvar propsQueue = this.Props.slice(0);\t\t\r\n\t\t\r\n\t\t/* initialize the state and prop orbits array */\r\n\t\tthis.States = [];\r\n\r\n\t\t/* initialize current state */\r\n\t\tvar curState : (Prop[]|null)[][][] = []; // curState[juggler][hand][beat] can be null (ie. no props landing) or Prop[] (ie. list of props landing, more than 1 in case of a multiplex)\r\n\t\tfor (var j = 0; j < Siteswap.NumJugglers; j++) {\r\n\t\t\tcurState.push([[],[]]);\r\n\t\t\tfor (var k = 0; k < maxHeight; k++) {\r\n\t\t\t\tcurState[j][Hand.Left].push(null);\r\n\t\t\t\tcurState[j][Hand.Right].push(null);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar patternComplete = false;\r\n\t\tvar initComplete = false;\r\n\t\tvar beat = 0;\r\n\t\tvar hand = Hand.Left;\r\n\t\t\r\n\t\twhile (!patternComplete) {\r\n\t\t\t\r\n\t\t\t/* queue of props to throw this beat */\r\n\t\t\tvar propsLanding : PropLanding[] = [];\r\n\r\n\t\t\tcurState.forEach((juggler, jugglerIx) => {\r\n\t\t\t\tvar landingLeft = juggler[Hand.Left].shift();\r\n\t\t\t\tjuggler[Hand.Left].push(null);\r\n\t\t\t\tif (landingLeft) {\r\n\t\t\t\t\tlandingLeft.forEach(prop => {\r\n\t\t\t\t\t\tpropsLanding.push({\r\n\t\t\t\t\t\t\tProp: prop,\r\n\t\t\t\t\t\t\tJuggler: jugglerIx,\r\n\t\t\t\t\t\t\tHand: Hand.Left\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar landingRight = juggler[Hand.Right].shift();\r\n\t\t\t\tjuggler[Hand.Right].push(null);\r\n\t\t\t\tif (landingRight) {\r\n\t\t\t\t\tlandingRight.forEach(prop => {\r\n\t\t\t\t\t\tpropsLanding.push({\r\n\t\t\t\t\t\t\tProp: prop,\r\n\t\t\t\t\t\t\tJuggler: jugglerIx,\r\n\t\t\t\t\t\t\tHand: Hand.Right\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t/* iterate through all the tosses and update the current state */\r\n\t\t\tthis.TossCollection[beat % this.TossCollection.length].forEach(toss => {\r\n\t\t\t\t\r\n\t\t\t\tvar tossHand = toss.Hand == Hand.Any ? hand : toss.Hand;\r\n\t\t\t\tvar catchHand = toss.Crossing ? 1 - tossHand : tossHand; \r\n\r\n\t\t\t\tvar propToToss : Prop|undefined = undefined;\r\n\r\n\t\t\t\t// go through props landing and look for one landing in the hand that this toss is occurring\r\n\t\t\t\tfor (var propLandingIx = 0; propLandingIx < propsLanding.length; propLandingIx++) {\r\n\t\t\t\t\tvar propLanding = propsLanding[propLandingIx];\r\n\t\t\t\t\tif(propLanding.Hand == tossHand && propLanding.Juggler == toss.Juggler) {\r\n\t\t\t\t\t\t// if a prop is landing in a hand that is tossing a 0 then invalid pattern\r\n\t\t\t\t\t\tif(toss.NumBeats == 0) {\r\n\t\t\t\t\t\t\tthrow `Prop landing on 0 toss at beat ${beat}`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tpropToToss = propLanding.Prop;\r\n\t\t\t\t\t\tpropsLanding.splice(propLandingIx,1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if no props landing to be thrown, get one from the queue - only if this isn't a 0 toss\r\n\t\t\t\tif  (propToToss === undefined && toss.NumBeats > 0) {\r\n\t\t\t\t\tpropToToss = propsQueue.shift();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if prop is still undefined (ie. there are none left) then we've got an invalid siteswap - only if this isn't a 0 toss\r\n\t\t\t\tif  (propToToss === undefined && toss.NumBeats > 0) {\r\n\t\t\t\t\tthrow `No prop available to toss at beat ${beat}`;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// so long as this isn't a 0 toss, update the current state and add to props scheduled tosses\r\n\t\t\t\tif (toss.NumBeats > 0) {\t\t\t\t\r\n\r\n\t\t\t\t\t// only build TossSchedule once init is complete \r\n\t\t\t\t\tif (initComplete) {\r\n\t\r\n\t\t\t\t\t\tpropToToss!.TossSchedule.push({\r\n\t\t\t\t\t\t\tToss: toss,\r\n\t\t\t\t\t\t\tBeat: beat,\r\n\t\t\t\t\t\t\tHand: tossHand\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\tif(curState[toss.TargetJuggler][catchHand][toss.NumBeats-1]) {\r\n\t\t\t\t\t\tcurState[toss.TargetJuggler][catchHand][toss.NumBeats-1]!.push(propToToss as Prop);\t\t\t\t\t\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcurState[toss.TargetJuggler][catchHand][toss.NumBeats-1] = [propToToss as Prop];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t});\t\r\n\t\t\t\r\n\t\t\t// TODO: address performance/memory concerns with constantly recreating state arrays using this deep clone method\r\n\t\t\tif(initComplete) {\r\n\t\t\t\t// if we're at the beginning of the toss array and we've returned to the original state, the pattern is complete\r\n\t\t\t\tif (beat % this.TossCollection.length == 0 && JSON.stringify(this.States[0], [\"Id\"]) == JSON.stringify(curState, [\"Id\"])) {\r\n\t\t\t\t\tpatternComplete = true;\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t// if the pattern is complete now we need to remove the last set of scheduled tosses\r\n\t\t\t\t\t// this is kind of a hack\t\t\t\t\r\n\t\t\t\t\tthis.Props.forEach(prop => {\r\n\t\t\t\t\t\tvar i = 0;\r\n\t\t\t\t\t\tif (prop.TossSchedule[prop.TossSchedule.length-1].Beat == beat) {\r\n\t\t\t\t\t\t\tprop.TossSchedule.pop();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// add the current state to the state array\r\n\t\t\t\t\tthis.States.push(JSON.parse(JSON.stringify(curState, [\"Id\"])));\r\n\t\t\t\t}\t\r\n\t\t\t} else {\r\n\t\t\t\t// if all props have been introduced to pattern and we're at the end of the pattern, init is complete and steady-state pattern truly begins with the next beat\r\n\t\t\t\tif (propsQueue.length == 0 && (beat+1) % this.TossCollection.length == 0) {\r\n\t\t\t\t\tinitComplete = true;\r\n\t\t\t\t\tbeat = -1;\r\n\t\t\t\t\tthis.States = []; \r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\r\n\t\t\tbeat++;\r\n\t\t\thand = 1 - hand; //alternate hands\r\n\r\n\t\t\t/* fail safe in case the pattern is too long */\r\n\t\t\tif (beat > 1000) {\r\n\t\t\t\tthrow \"Pattern took more than 1000 beats to repeat states\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate sumThrows(str : string) : number {\r\n\t\tvar total = 0;\r\n\t\tfor (var i = 0; i < str.length; i++) {\r\n\t\t\tif(parseInt(str[i])) {\r\n\t\t\t\ttotal += parseInt(str[i]);\t\t\t\t\t\r\n\t\t\t} else if (str.charCodeAt(i) >= 97 && str.charCodeAt(i) <= 119) {\r\n\t\t\t\t// handle \"a\" through \"z\" (where \"a\" = 10)\r\n\t\t\t\ttotal += str.charCodeAt(i)-87;\r\n\t\t\t}\r\n\t\r\n\t\t\t// if the current character is a pass/spin marker\r\n\t\t\t// ignore the next character so we don't count the\r\n\t\t\t// juggler identifier  in something like <5p2|5p3|5p1>\r\n\t\t\tif ((str[i] == \"P\" || str[i] == \"S\") && parseInt(str[i+1]) ){\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t\t// if the current character is a bounce marker\r\n\t\t\t// and then next character is a {, move forward until we find a }\r\n\t\t\tif ((str[i] == \"B\" || str[i] == \"D\" || str[i] == \"T\" || str[i] == \"C\" || str[i] == \"S\") && str[i+1] == \"{\") {\r\n\t\t\t\ti = str.indexOf(\"}\",i);\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\treturn total;\r\n\t}\r\n\r\n\tpublic Simulate(numStepsPerBeat : number, beatDuration : number, breakOnCollision : boolean = false) : boolean {\r\n\t\tvar totalNumBeats = this.States.length;\r\n\t\tvar numSteps = totalNumBeats*numStepsPerBeat;\t\t\r\n\t\tvar hasCollision = false;\r\n\t\t\r\n\t\t// initialize pattern simulation\r\n\t\tvar patternSimulation : PatternSimulation = {\r\n\t\t\tProps: [],\r\n\t\t\tJugglers: [],\r\n\t\t\tBeatDuration: beatDuration,\r\n\t\t\tNumStepsPerBeat: numStepsPerBeat,\r\n\t\t};\r\n\r\n\t\tthis.Props.forEach(prop => patternSimulation.Props.push({\r\n\t\t\tPositions: [],\r\n\t\t\tRotations: []\r\n\t\t}));\r\n\r\n\t\tthis.States[0].forEach((juggler, jugglerIx, jugglers) => {\r\n\t\t\r\n\t\t\t// todo - this is still a bit hokey and should be based on inputs\r\n\r\n\t\t\tvar bodyPosition : vec3;\r\n\t\t\tvar bodyRotation : number;\r\n\r\n\t\t\tif (jugglers.length == 1) {\r\n\t\t\t\tbodyPosition = new vec3([0,0,0]);\r\n\t\t\t\tbodyRotation = 0;\r\n\t\t\t} else {\r\n\t\t\t\tvar jugglerCircleRadius = 1;\r\n\r\n\t\t\t\tvar t = jugglerIx/jugglers.length;\r\n\r\n\t\t\t\tbodyRotation = t*Math.PI*2;\r\n\r\n\t\t\t\tbodyPosition = new vec3([\r\n\t\t\t\t\t-jugglerCircleRadius*Math.sin(bodyRotation),\r\n\t\t\t\t\t0,\r\n\t\t\t\t\tjugglerCircleRadius*Math.cos(bodyRotation)\r\n\t\t\t\t]);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tpatternSimulation.Jugglers.push({\r\n\t\t\t\tBodyPositions: Array(numSteps).fill(bodyPosition),\r\n\t\t\t\tBodyRotations: Array(numSteps).fill(bodyRotation),\r\n\t\t\t\tLeftHandPositions: [],\r\n\t\t\t\tRightHandPositions: [],\r\n\t\t\t\tLeftElbowPositions: [],\r\n\t\t\t\tRightElbowPositions: [],\r\n\t\t\t\tLeftHandDirections: [],\r\n\t\t\t\tRightHandDirections: []\r\n\t\t\t})\r\n\t\t});\r\n\r\n\t\tfor(var step = 0; step < numSteps; step++) {\r\n\t\t\tvar currentBeat = Math.floor(step*totalNumBeats/numSteps);\r\n\t\t\tvar currentTime = beatDuration*step*totalNumBeats/numSteps;\r\n\r\n\t\t\t// find position of each prop\r\n\t\t\tthis.Props.forEach((prop, propIx) => {\r\n\t\t\t\tvar prevToss : ScheduledToss;\r\n\t\t\t\tvar curToss : ScheduledToss;\r\n\t\t\t\tvar nextToss : ScheduledToss;\r\n\r\n\t\t\t\t[prevToss, curToss, nextToss] = prop.GetPreviousCurrentAndNextTossForBeat(currentBeat);\r\n\r\n\t\t\t\t// create \"virtual\" beat/time if the previous/next toss results in a loop back through the states\r\n\t\t\t\tvar virtualCurrentTime = currentTime;\r\n\r\n\t\t\t\tvar prevTossVirtualBeat = prevToss.Beat;\r\n\t\t\t\tif (prevTossVirtualBeat >= curToss.Beat) {\r\n\t\t\t\t\tprevTossVirtualBeat -= totalNumBeats;\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar nextTossVirtualBeat = nextToss.Beat;\r\n\t\t\t\tvar curTossVirtualBeat = curToss.Beat;\r\n\t\t\t\tif (nextTossVirtualBeat <= curToss.Beat) {\r\n\t\t\t\t\tprevTossVirtualBeat -= totalNumBeats;\r\n\t\t\t\t\tcurTossVirtualBeat -= totalNumBeats;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar tossTime = curTossVirtualBeat*beatDuration + curToss.Toss.DwellRatio*beatDuration;\r\n\t\t\t\tvar catchTime = nextTossVirtualBeat*beatDuration;\r\n\t\t\t\tvar prevTossTime = prevTossVirtualBeat*beatDuration + prevToss.Toss.DwellRatio*beatDuration;\r\n\t\t\t\tvar prevCatchTime = curTossVirtualBeat*beatDuration;\r\n\r\n\t\t\t\tif (virtualCurrentTime >= catchTime) {\r\n\t\t\t\t\tvirtualCurrentTime -= totalNumBeats*beatDuration;\r\n\t\t\t\t}\t\t\t\t\t\t\t\r\n\r\n\t\t\t\tvar prevTossJugglerBodyPosition = patternSimulation.Jugglers[prevToss.Toss.Juggler].BodyPositions[step];\r\n\t\t\t\tvar prevTossJugglerBodyRotation = patternSimulation.Jugglers[prevToss.Toss.Juggler].BodyRotations[step];\r\n\r\n\t\t\t\tvar tossJugglerBodyPosition = patternSimulation.Jugglers[curToss.Toss.Juggler].BodyPositions[step];\r\n\t\t\t\tvar tossJugglerBodyRotation = patternSimulation.Jugglers[curToss.Toss.Juggler].BodyRotations[step];\r\n\r\n\t\t\t\tvar catchJugglerBodyPosition = patternSimulation.Jugglers[nextToss.Toss.Juggler].BodyPositions[step];\r\n\t\t\t\tvar catchJugglerBodyRotation = patternSimulation.Jugglers[nextToss.Toss.Juggler].BodyRotations[step];\r\n\r\n\t\t\t\t// if we're before the toss then we're in the dwell path\r\n\t\t\t\tif (virtualCurrentTime < tossTime || curToss.Toss.Hold) {\r\n\t\t\t\t\t// velocity at time of catch\r\n\t\t\t\t\tvar prevTossFlightTime = prevCatchTime - prevTossTime;\t\t\t\t\r\n\r\n\t\t\t\t\tvar catchVelocity = GetTossPathPositionAndVelocity(prevToss, curToss, prevTossFlightTime, prevTossFlightTime, prevTossJugglerBodyPosition, prevTossJugglerBodyRotation, tossJugglerBodyPosition, tossJugglerBodyRotation)[1];\r\n\r\n\t\t\t\t\t// velocity at the time of throw\r\n\t\t\t\t\tvar tossVelocity = GetTossPathPositionAndVelocity(curToss, nextToss, 0, catchTime-tossTime, tossJugglerBodyPosition, tossJugglerBodyRotation, catchJugglerBodyPosition, catchJugglerBodyRotation)[1];\r\n\r\n\t\t\t\t\tvar t : number;\r\n\t\t\t\t\tif (curToss.Toss.Hold) {\r\n\t\t\t\t\t\tvar t = 1 - (catchTime - virtualCurrentTime) / (catchTime - prevCatchTime);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar t = 1 - (tossTime - virtualCurrentTime) / (tossTime - prevCatchTime);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar pos = curToss.Toss.DwellPath.GetPosition(t, curToss.Hand, catchVelocity, tossVelocity, 0.01, 0.015, curToss.Toss.Hold ? nextToss.Toss.DwellPath.Snapshots[0] : null, tossJugglerBodyPosition, tossJugglerBodyRotation);\r\n\t\t\t\t\t\r\n\t\t\t\t\tpatternSimulation.Props[propIx].Positions.push(pos);\t\t\t\t\t\r\n\t\t\t\t\tvar handDirection = catchVelocity.copy().normalize().scale(t-1);\r\n\t\t\t\t\thandDirection.add(tossVelocity.copy().normalize().scale(t));\r\n\r\n\r\n\t\t\t\t\tif (curToss.Hand === Hand.Left) {\r\n\t\t\t\t\t\tpatternSimulation.Jugglers[curToss.Toss.Juggler].LeftHandPositions[step] = pos;\r\n\t\t\t\t\t\tpatternSimulation.Jugglers[curToss.Toss.Juggler].LeftHandDirections[step] = handDirection;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpatternSimulation.Jugglers[curToss.Toss.Juggler].RightHandPositions[step] = pos;\r\n\t\t\t\t\t\tpatternSimulation.Jugglers[curToss.Toss.Juggler].RightHandDirections[step] = handDirection;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// figure out flight path\r\n\t\t\t\t\tvar T = catchTime - tossTime;\r\n\t\t\t\t\tvar t = virtualCurrentTime - tossTime;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar pos = GetTossPathPositionAndVelocity(curToss, nextToss, t, T, tossJugglerBodyPosition, tossJugglerBodyRotation, catchJugglerBodyPosition, catchJugglerBodyRotation)[0];\r\n\r\n\t\t\t\t\tpatternSimulation.Props[propIx].Positions.push(pos);\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\t// check to see if any of the props are colliding\r\n\t\t\tfor (var i = 0; i < this.Props.length; i++) {\r\n\t\t\t\tfor (var j = i+1; j < this.Props.length; j++) {\r\n\t\t\t\t\tvar pos1 = patternSimulation.Props[i].Positions[step];\r\n\t\t\t\t\tvar pos2 = patternSimulation.Props[j].Positions[step];\r\n\t\t\t\t\tvar dist = vec3.distance(pos1, pos2);\r\n\t\t\t\t\tif (dist < this.Props[i].Radius || dist < this.Props[j].Radius) {\r\n\t\t\t\t\t\tif (breakOnCollision) {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\thasCollision = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// find position for hands that are empty and calculate elbow positions\r\n\t\t\tpatternSimulation.Jugglers.forEach((juggler, jugglerIx) => {\r\n\t\t\t\t[Hand.Left, Hand.Right].forEach((hand) => {\r\n\t\t\t\t\t/* need \r\n\t\t\t\t\t\tnextToss - to determine where the hand is going to\r\n\t\t\t\t\t\tpropLastToss - to determine where the prop we're catching came from so we know its catch velocity\r\n\t\t\t\t\t\tlastToss - to determine where the hand is coming from\r\n\t\t\t\t\t\tpropNextToss - to determine where the prop we just tossed is going so we know its toss velocity\r\n\t\t\t\t\t*/\r\n\r\n\t\t\t\t\tif ((hand === Hand.Left && juggler.LeftHandPositions[step] === undefined) || (hand === Hand.Right && juggler.RightHandPositions[step] === undefined)) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar handNextToss : ScheduledToss|undefined;\r\n\t\t\t\t\t\tvar handNextTossVirtualBeat : number = 0;\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.Props.forEach((prop) => {\r\n\t\t\t\t\t\t\tprop.TossSchedule.forEach((scheduledToss) => {\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar scheduledTossVirtualBeat = scheduledToss.Beat;\r\n\t\t\t\t\t\t\t\tif (scheduledTossVirtualBeat <= currentBeat) {\r\n\t\t\t\t\t\t\t\t\tscheduledTossVirtualBeat += totalNumBeats;\r\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (scheduledTossVirtualBeat > currentBeat && scheduledToss.Toss.Juggler == jugglerIx && scheduledToss.Hand == hand) {\r\n\t\t\t\t\t\t\t\t\tif (handNextToss === undefined || scheduledTossVirtualBeat < handNextTossVirtualBeat) {\r\n\t\t\t\t\t\t\t\t\t\thandNextToss = scheduledToss;\r\n\t\t\t\t\t\t\t\t\t\thandNextTossVirtualBeat = scheduledTossVirtualBeat;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tvar handLastToss : ScheduledToss|undefined;\t\r\n\t\t\t\t\t\tvar handLastTossVirtualBeat : number = 0;\t\t\t\t\t\r\n\t\t\t\t\t\tthis.Props.forEach((prop) => {\r\n\t\t\t\t\t\t\tprop.TossSchedule.forEach((scheduledToss) => {\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar scheduledTossVirtualBeat = scheduledToss.Beat;\r\n\t\t\t\t\t\t\t\tif (scheduledTossVirtualBeat > currentBeat) {\r\n\t\t\t\t\t\t\t\t\tscheduledTossVirtualBeat -= totalNumBeats;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (scheduledTossVirtualBeat <= currentBeat && scheduledToss.Toss.Juggler == jugglerIx && scheduledToss.Hand == hand) {\r\n\t\t\t\t\t\t\t\t\tif (handLastToss === undefined || scheduledTossVirtualBeat > handLastTossVirtualBeat) {\r\n\t\t\t\t\t\t\t\t\t\thandLastToss = scheduledToss;\r\n\t\t\t\t\t\t\t\t\t\thandLastTossVirtualBeat = scheduledTossVirtualBeat;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tvar handPos : vec3;\r\n\t\t\t\t\t\tvar handDirection : vec3;\r\n\t\t\t\t\t\tif (handLastToss === undefined || handNextToss === undefined) {\r\n\t\t\t\t\t\t\t// TODO - don't hardcode this\r\n\t\t\t\t\t\t\thandPos = new vec3([.3*hand == Hand.Left ? -1 : 1, BasePatternHeight, 0]);\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\thandDirection = new vec3([0,1,0]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar emptyHandPath : vec3[] = [];\r\n\t\t\t\t\t\t\temptyHandPath.push(handLastToss.Toss.DwellPath.Snapshots[handLastToss.Toss.DwellPath.Snapshots.length-1].Position.copy());\r\n\t\t\t\t\t\t\temptyHandPath.push(handNextToss.Toss.DwellPath.Snapshots[0].Position.copy());\r\n\r\n\t\t\t\t\t\t\tvar catchingPropLastToss : ScheduledToss;\r\n\t\t\t\t\t\t\tvar tossedPropNextToss : ScheduledToss;\r\n\r\n\t\t\t\t\t\t\tthis.Props.forEach((prop) => {\r\n\t\t\t\t\t\t\t\tprop.TossSchedule.forEach((scheduledToss, scheduledTossIx, tossSchedule) => {\r\n\t\t\t\t\t\t\t\t\tif(scheduledToss.Hand === hand && scheduledToss.Beat === handNextToss!.Beat && scheduledToss.Toss.Juggler === jugglerIx) {\r\n\t\t\t\t\t\t\t\t\t\tif (scheduledTossIx == 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tcatchingPropLastToss = tossSchedule[tossSchedule.length-1];\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tcatchingPropLastToss = tossSchedule[scheduledTossIx-1];\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis.Props.forEach((prop) => {\r\n\t\t\t\t\t\t\t\tprop.TossSchedule.forEach((scheduledToss, scheduledTossIx, tossSchedule) => {\r\n\t\t\t\t\t\t\t\t\tif(scheduledToss === handLastToss) {\r\n\t\t\t\t\t\t\t\t\t\tif (scheduledTossIx === (tossSchedule.length-1)) {\r\n\t\t\t\t\t\t\t\t\t\t\ttossedPropNextToss = tossSchedule[0];\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\ttossedPropNextToss = tossSchedule[scheduledTossIx+1];\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// the juggler whose empty hand we're calculting\r\n\t\t\t\t\t\t\tvar jugglerBodyPosition = juggler.BodyPositions[step];\r\n\t\t\t\t\t\t\tvar jugglerBodyRotation = juggler.BodyRotations[step];\r\n\r\n\t\t\t\t\t\t\t// the juggler that we just tossed a prop to\r\n\t\t\t\t\t\t\tvar tossedPropCatchingJugglerBodyPosition = patternSimulation.Jugglers[handLastToss.Toss.TargetJuggler].BodyPositions[step];\r\n\t\t\t\t\t\t\tvar tossedPropCatchingJugglerBodyRotation = patternSimulation.Jugglers[handLastToss.Toss.TargetJuggler].BodyRotations[step]; \r\n\r\n\t\t\t\t\t\t\t// the juggler that tossed the prop we're catching\r\n\t\t\t\t\t\t\tvar catchingPropTossJugglerBodyPosition = patternSimulation.Jugglers[catchingPropLastToss!.Toss.Juggler].BodyPositions[step];\r\n\t\t\t\t\t\t\tvar catchingPropTossJugglerBodyRotation = patternSimulation.Jugglers[catchingPropLastToss!.Toss.Juggler].BodyRotations[step];\r\n\r\n\t\t\t\t\t\t\tvar tossVelocity = GetTossPathPositionAndVelocity(handLastToss, tossedPropNextToss!, 0, handLastToss.Toss.NumBeats*beatDuration, jugglerBodyPosition, jugglerBodyRotation, tossedPropCatchingJugglerBodyPosition, tossedPropCatchingJugglerBodyRotation)[1];\r\n\t\t\t\t\t\t\tvar catchVelocity = GetTossPathPositionAndVelocity(catchingPropLastToss!, handNextToss, catchingPropLastToss!.Toss.NumBeats*beatDuration-catchingPropLastToss!.Toss.DwellRatio*beatDuration,catchingPropLastToss!.Toss.NumBeats*beatDuration-catchingPropLastToss!.Toss.DwellRatio*beatDuration, catchingPropTossJugglerBodyPosition, catchingPropTossJugglerBodyRotation, jugglerBodyPosition, jugglerBodyRotation)[1];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (hand === Hand.Left) {\r\n\t\t\t\t\t\t\t\temptyHandPath.forEach((x) => x.x*=-1);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar virtualCurrentTime = currentTime;\r\n\t\t\t\t\t\t\tif (virtualCurrentTime > handNextTossVirtualBeat*beatDuration) {\r\n\t\t\t\t\t\t\t\tvirtualCurrentTime -= totalNumBeats*beatDuration;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar totalEmptyHandTime = handNextTossVirtualBeat*beatDuration - (handLastTossVirtualBeat*beatDuration + handLastToss.Toss.DwellRatio*beatDuration);\r\n\t\t\t\t\t\t\tvar t = (virtualCurrentTime - (handLastTossVirtualBeat*beatDuration + handLastToss.Toss.DwellRatio*beatDuration))/totalEmptyHandTime;\r\n\r\n\t\t\t\t\t\t\t// todo - this probably doesn't actually work\r\n\t\t\t\t\t\t\t// fail-safe in case virtual times weren't calculated perfectly\r\n\t\t\t\t\t\t\t// solves bug with hands flashing to wrong position for even patterns like 4\r\n\t\t\t\t\t\t\tif (t < 0) {\r\n\t\t\t\t\t\t\t\tt = 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (t > 1) {\r\n\t\t\t\t\t\t\t\tt = 0;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tfor (var i = 0; i < emptyHandPath.length; i++) {\r\n\t\t\t\t\t\t\t\tvar copy = emptyHandPath[i].copy();\r\n\t\t\t\t\t\t\t\temptyHandPath[i].x = copy.x*Math.cos(jugglerBodyRotation) - copy.z*Math.sin(jugglerBodyRotation);\r\n\t\t\t\t\t\t\t\temptyHandPath[i].y = copy.y + BasePatternHeight;\r\n\t\t\t\t\t\t\t\temptyHandPath[i].z = copy.x*Math.sin(jugglerBodyRotation) + copy.z*Math.cos(jugglerBodyRotation);\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\temptyHandPath[i].add(jugglerBodyPosition);\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\thandPos = InterpolateBezierSpline(emptyHandPath,t,tossVelocity,catchVelocity,0.01,0.01,false);\r\n\r\n\t\t\t\t\t\t\thandDirection = tossVelocity.copy().normalize().scale(1-t);\r\n\t\t\t\t\t\t\thandDirection.add(catchVelocity.copy().normalize().scale(-t));\r\n\r\n\t\t\t\t\t\t}\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (hand === Hand.Left) {\r\n\t\t\t\t\t\t\tjuggler.LeftHandPositions[step] = handPos;\r\n\t\t\t\t\t\t\tjuggler.LeftHandDirections[step] = handDirection;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tjuggler.RightHandPositions[step] = handPos;\r\n\t\t\t\t\t\t\tjuggler.RightHandDirections[step] = handDirection;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// now that both hands are accounted for, calculate elbow positions\t\t\t\t\t\r\n\t\t\t\t\tvar rot = juggler.BodyRotations[step];\r\n\t\t\t\t\tvar pos = juggler.BodyPositions[step];\r\n\t\t\t\t\tvar x = (hand === Hand.Left ? - 1 : 1)*ShoulderXOffset;\r\n\t\t\t\t\tvar z = ShoulderZOffset;\r\n\t\t\t\t\tvar shoulderPosition = new vec3([\r\n\t\t\t\t\t\tpos.x + (x*Math.cos(rot) - z*Math.sin(rot)),\r\n\t\t\t\t\t\tShoulderHeight,\r\n\t\t\t\t\t\tpos.z + (x*Math.sin(rot) + z*Math.cos(rot))\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t]);\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar elbowPosition = this.getElbowPosition(shoulderPosition, hand === Hand.Left ? juggler.LeftHandPositions[step] : juggler.RightHandPositions[step], ArmAngle, hand);\r\n\t\t\t\t\tif (hand === Hand.Left) {\r\n\t\t\t\t\t\tjuggler.LeftElbowPositions[step] = elbowPosition;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tjuggler.RightElbowPositions[step] = elbowPosition;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\tthis.Simulation = patternSimulation;\r\n\r\n\t\treturn hasCollision;\r\n\r\n\t}\r\n\r\n\tprivate getElbowPosition(shoulderPosition : vec3, handPosition : vec3, armAngle : number, hand : Hand) : vec3 {\r\n\t\tvar armHalfLength = ArmHalfLength;\r\n\r\n\t\tarmAngle*=-1;\r\n\r\n\t\tvar Hp = new vec3();\r\n\t\tHp.x = handPosition.x - shoulderPosition.x;\r\n\t\tHp.y = handPosition.y - shoulderPosition.y;\r\n\t\tHp.z = handPosition.z - shoulderPosition.z;\r\n\r\n\t\tvar Hpp = new vec3();\r\n\t\tHpp.x = Math.sqrt(Hp.x*Hp.x + Hp.z*Hp.z);\r\n\t\tHpp.y = Hp.y;\r\n\t\tHpp.z = 0;\r\n\r\n\t\tvar th = Math.atan2(Hp.z,Hp.x);\r\n\r\n\t\tvar magHp = Math.sqrt(Hp.x*Hp.x + Hp.y*Hp.y + Hp.z*Hp.z);\r\n\r\n\t\t/* magically stretch arms */\r\n\t\tif (2*armHalfLength < magHp) {\r\n\t\t\tarmHalfLength = magHp/2;\r\n\t\t}\r\n\r\n\t\tvar u1 = new vec3();\r\n\t\tu1.x = Hpp.y/magHp;\r\n\t\tu1.y = -Hpp.x/magHp;\r\n\t\tu1.z = 0;\r\n\r\n\t\tvar u2 = new vec3([0,0,0]);\r\n\t\tif (hand == 1) {\r\n\t\t\tu2.z = -1;\r\n\t\t} else {\r\n\t\t\tu2.z = 1;\r\n\t\t}\r\n\r\n\t\tvar h = Math.sqrt(armHalfLength*armHalfLength - .25*magHp*magHp);\r\n\r\n\t\tvar Epp = new vec3();\r\n\t\tEpp.x = Hpp.x/2 + h*u1.x*Math.cos(armAngle) + h*u2.x*Math.sin(armAngle);\r\n\t\tEpp.y = Hpp.y/2 + h*u1.y*Math.cos(armAngle) + h*u2.y*Math.sin(armAngle);\r\n\t\tEpp.z = Hpp.z/2 + h*u1.z*Math.cos(armAngle) + h*u2.z*Math.sin(armAngle);\r\n\r\n\t\tvar Ep = new vec3();\r\n\t\tEp.x = Epp.x*Math.cos(th) - Epp.z*Math.sin(th);\r\n\t\tEp.y = Epp.y;\r\n\t\tEp.z = Epp.x*Math.sin(th) + Epp.z*Math.cos(th);\t\r\n\r\n\t\tvar E = new vec3();\r\n\t\tE.x = Ep.x + shoulderPosition.x;\r\n\t\tE.y = Ep.y + shoulderPosition.y;\r\n\t\tE.z = Ep.z + shoulderPosition.z;\r\n\r\n\r\n\t\treturn E;\r\n\t}\r\n\r\n\tpublic GetHeighestAndLowestPositionInSimulation() : [number, number] {\r\n\t\tvar highestPoint = BasePatternHeight;\r\n\t\tvar lowestPoint = BasePatternHeight;\r\n\t\tif (this.Simulation) {\t\t\t\r\n\t\t\tthis.Simulation.Props.forEach((prop) => {\r\n\t\t\t\tprop.Positions.forEach((p) => {\r\n\t\t\t\t\tif (p.y > highestPoint) {\r\n\t\t\t\t\t\thighestPoint = p.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (p.y < lowestPoint) {\r\n\t\t\t\t\t\tlowestPoint = p.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\t\t\t\r\n\t\t} \r\n\t\treturn [highestPoint, lowestPoint];\r\n\t}\r\n}","import { vec3, vec4 } from \"@tlaukkan/tsm\";\r\n\r\n// TODO: this wasn't ported completely from Siteswap.js\r\nexport const DefaultClubRotation = new vec4([4,0,1,Math.PI/2]);\r\nexport const DefaultRingRotation = new vec4([0,1,0,Math.PI/2]);\r\nexport const DefaultBallRotation = new vec4([0,0,0,0]);\r\n\r\nexport class DwellPathSnapshot {\r\n\t\r\n\tpublic readonly Position : vec3;\r\n\tpublic readonly Rotation : vec4;\r\n\tpublic readonly Empty : boolean;\r\n\r\n\tconstructor(input: string, empty : boolean = false, defaultRotation : vec4 = DefaultBallRotation) {\r\n\t\tthis.Empty = empty;\r\n\r\n\t\tvar xyzMatch = input.match(/\\(-?\\d+(\\.\\d+)?(,-?\\d+(\\.\\d+)?)?(,-?\\d+(\\.\\d+)?)?/g)\r\n\t\tif (!xyzMatch) {\r\n\t\t\tthrow \"Could not find position for dwell path snapshot.\"\r\n\t\t} else {\r\n\t\t\tvar xyz = xyzMatch[0].match(/-?\\d+(\\.\\d+)?/g);\r\n\t\t\tif (xyz) {\r\n\t\t\t\tthis.Position = new vec3([\r\n\t\t\t\t\tparseFloat(xyz[0])/100,\r\n\t\t\t\t\t// y and z default to 0\r\n\t\t\t\t\txyz[1] ? parseFloat(xyz[1])/100 : 0,\r\n\t\t\t\t\txyz[2] ? parseFloat(xyz[2])/100 : 0\r\n\t\t\t\t]);\r\n\t\t\t} else {\r\n\t\t\t\tthrow \"Could not find position for dwell path snapshot.\"\r\n\t\t\t}\t\t\t\t\t\t\r\n\t\t}\t\t\t\r\n\t\t\r\n\t\tvar rot = input.match(/\\{-?\\d+(\\.\\d+)?,-?\\d+(\\.\\d+)?,-?\\d+(\\.\\d+)?,-?\\d+(\\.\\d+)?\\}/g); \r\n\t\tif (!rot) {\r\n\t\t\tthis.Rotation = defaultRotation;\r\n\t\t} else {\r\n\t\t\tvar rotationValues = rot[0].match(/-?\\d+(\\.\\d+)?/g);\r\n\t\t\tif (rotationValues && rotationValues.length == 4) {\r\n\t\t\t\tthis.Rotation = new vec4([\r\n\t\t\t\t\tparseFloat(rotationValues[0]),\r\n\t\t\t\t\tparseFloat(rotationValues[1]),\r\n\t\t\t\t\tparseFloat(rotationValues[2]),\r\n\t\t\t\t\tparseFloat(rotationValues[3])\r\n\t\t\t\t]);\r\n\t\t\t} else {\r\n\t\t\t\tthrow \"Could not find 4 rotation values\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}","import { DwellPathSnapshot, DefaultBallRotation } from \"./DwellPathSnapshot\";\r\nimport { vec4, vec3 } from \"@tlaukkan/tsm\";\r\nimport { Hand } from \"./Toss\";\r\nimport { InterpolateBezierSpline } from \"./Bezier\";\r\nimport { BasePatternHeight } from \"./JugglerConfig\";\r\n\t\r\nexport class DwellPath {\r\n\r\n\tpublic readonly Snapshots : DwellPathSnapshot[];\r\n\r\n\tconstructor(input : string, defaultRotation : vec4 = DefaultBallRotation) {\r\n\t\tthis.Snapshots = [];\r\n\r\n\t\t// check if there's going to be any empty hand dwell path snapshots\r\n\t\t// if not then terminate the input with an e\r\n\t\tif (input.indexOf(\"e\") == -1) {\r\n\t\t\tinput += \"e\";\r\n\t\t}\r\n\t\tvar dwellPathSnapshotRe = /\\(-?\\d+(\\.\\d+)?(,-?\\d+(\\.\\d+)?)?(,-?\\d+(\\.\\d+)?)?(,\\{-?\\d+(\\.\\d+)?,-?\\d+(\\.\\d+)?,-?\\d+(\\.\\d+)?,-?\\d+(\\.\\d+)?\\})?\\)/g;\r\n\t\tvar heldDwellPathSnapshots = input.split(\"e\")[0].match(dwellPathSnapshotRe);\r\n\t\tvar emptyDwellPathSnapshots = input.split(\"e\")[1].match(dwellPathSnapshotRe);\r\n\t\tif (heldDwellPathSnapshots) {\r\n\t\t\theldDwellPathSnapshots.forEach(x => {\r\n\t\t\t\tthis.Snapshots.push(new DwellPathSnapshot(x, false, defaultRotation))\r\n\t\t\t});\r\n\t\t} else {\t\t\r\n\t\t\tthrow new Error(\"Invalid dwell path\");\r\n\t\t}\r\n\t\tif (emptyDwellPathSnapshots) {\r\n\t\t\temptyDwellPathSnapshots.forEach(x => {\r\n\t\t\t\tthis.Snapshots.push(new DwellPathSnapshot(x, true, defaultRotation))\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t// todo - this should take an obect as params\r\n\tpublic GetPosition(\r\n\t\tt : number, \r\n\t\thand : Hand,\r\n\t\tstartVelocity : vec3,\r\n\t\tendVelocity : vec3,\r\n\t\tstartVelocityScale : number,\r\n\t\tendVelocityScale : number,\r\n\t\tadditionalPathSnapshot: DwellPathSnapshot | null, // optional dwell path snapshot to append to spline path\r\n\t\tjugglerBodyPosition : vec3,\r\n\t\tjugglerBodyRotation : number\r\n\t) : vec3 {\r\n\r\n\t\tvar splinePath = this.Snapshots.map((a) => { \r\n\t\t\treturn adjustDwellPathSnapshotByHandAndJuggler(a, hand, jugglerBodyPosition, jugglerBodyRotation);\r\n\t\t});\r\n\r\n\t\tif (additionalPathSnapshot) {\r\n\t\t\tsplinePath.push(adjustDwellPathSnapshotByHandAndJuggler(additionalPathSnapshot, hand, jugglerBodyPosition, jugglerBodyRotation));\r\n\t\t}\r\n\r\n\t\tvar pos = new vec3();\r\n\t\tif (t == 0) {\r\n\t\t\tpos = splinePath[0].copy();\r\n\t\t} else if (t == 1) {\r\n\t\t\tpos = splinePath[splinePath.length-1].copy();\t\t\t\r\n\t\t} else {\t\t\t\t\t\t\t\t\t\r\n\t\t\tpos = InterpolateBezierSpline(splinePath,t,startVelocity,endVelocity,startVelocityScale,endVelocityScale,false);\r\n\t\t}\t\t\t\t\r\n\r\n\t\treturn pos;\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction adjustDwellPathSnapshotByHandAndJuggler(a: DwellPathSnapshot, hand: Hand, jugglerBodyPosition : vec3, jugglerBodyRotation : number) {\r\n\tvar positionCopy = a.Position.copy();\r\n\tif (hand == Hand.Left) {\r\n\t\tpositionCopy.x *= -1;\r\n\t}\r\n\t\r\n\t// scale y by juggler height\r\n\tpositionCopy.y += BasePatternHeight;\r\n\r\n\tpositionCopy.x = positionCopy.x*Math.cos(jugglerBodyRotation) - positionCopy.z*Math.sin(jugglerBodyRotation);\r\n\tpositionCopy.z = positionCopy.x*Math.sin(jugglerBodyRotation) + positionCopy.z*Math.cos(jugglerBodyRotation);\r\n\r\n\tpositionCopy.add(jugglerBodyPosition);\r\n\r\n\treturn positionCopy;\r\n}\r\n\r\nexport function GetDwellPaths(input : string, defaultRotation : vec4 = DefaultBallRotation) : DwellPath[] {\r\n\tvar dwellPaths = input.split(').').map(function(a,ix,arr) { if (ix < arr.length-1) { return a+')'; } else { return a; } });\r\n\tif (dwellPaths) {\r\n\t\treturn dwellPaths.map(function(a) {\r\n\t\t\treturn new DwellPath(a);\r\n\t\t});\r\n\t} else {\r\n\t\tthrow new Error(\"Could not determine dwell paths\");\r\n\t}\r\n}","import { Node } from \"./Node\";\r\n\r\nexport interface Edge {\r\n\tSourceNode : number;\r\n\tTargetNode : number;\r\n\tValue : string;\r\n}\r\n\r\nexport function GetEdges(nodes : Node[]) : Edge[] {\r\n\tvar edges : Edge[] = [];\r\n\r\n\t// compare all nodes\r\n\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\tfor (var j = 0; j < nodes.length; j++) {\t\t\t\t\r\n\t\t\t\r\n\t\t\tvar edgeValue = GetEdgeValue(nodes[i], nodes[j]);\r\n\t\t\tif (edgeValue) {\r\n\t\t\t\tnodes[i].Edges.push(edges.push({SourceNode: i, TargetNode: j, Value: edgeValue})-1);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\treturn edges;\r\n}\r\n\r\n\r\nexport function GetEdgeValue(source : Node, target : Node) : string|null {\r\n\r\n\tvar edgeValue = \"\";\r\n\r\n\tvar nextUp = source.LandingSchedule[0];\r\n\tvar newNodeLandingSchedule = source.LandingSchedule.slice(1,target.LandingSchedule.length);\r\n\tnewNodeLandingSchedule.push(0);\r\n\r\n\r\n\tvar multiplex = false;\r\n\tif (nextUp == 0) {\r\n\t\tedgeValue = \"0\";\r\n\t} else if (nextUp > 1) {\r\n\t\tmultiplex = true;\r\n\t\tedgeValue = \"[\";\r\n\t}\r\n\tfor (var i = 0; i < newNodeLandingSchedule.length; i++) {\r\n\t\tvar tossValue = i+1;\r\n\t\tvar tossValueString = tossValue.toString();\r\n\t\tif (tossValue > 9) {\r\n\t\t\ttossValueString = String.fromCharCode(87+tossValue);\r\n\t\t}\r\n\t\tif(newNodeLandingSchedule[i] != target.LandingSchedule[i]) {\r\n\t\t\tif (nextUp >= (target.LandingSchedule[i] - newNodeLandingSchedule[i])) {\r\n\t\t\t\tedgeValue += tossValueString;\r\n\t\t\t\tnextUp--;\r\n\t\t\t\tif (nextUp == 1 && (target.LandingSchedule[i] - newNodeLandingSchedule[i]) == 2) {\r\n\t\t\t\t\tedgeValue += tossValueString;\r\n\t\t\t\t\tnextUp--;\r\n\t\t\t\t}\t\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (multiplex) {\r\n\t\tedgeValue += ']';\r\n\t}\t\r\n\r\n\treturn edgeValue;\r\n\r\n}","import { Node, GetNodes } from \"./Node\";\r\nimport { Edge, GetEdges } from \"./Edge\";\r\n\r\nexport interface FindSiteswapsConfig {\r\n\tMinPeriod: number;\r\n\tMaxPeriod: number;\r\n\tNumProps: number;\r\n\tIncludeMultiplex: boolean;\r\n\tIncludeExcited: boolean;\r\n\tMaxSearches: number;\r\n\tMaxSiteswaps: number;\r\n\tSync: boolean;\r\n\tExclude: string[];\r\n}\r\n\r\nfunction last<T>(arr : T[]) : T {\r\n\treturn arr[arr.length-1];\r\n}\r\n\r\n\r\nexport function FindSiteswaps(config : FindSiteswapsConfig) : string[] {\r\n\r\n\tvar nodes = GetNodes(config.MaxPeriod, config.NumProps, config.IncludeMultiplex);\r\n\tvar edges = GetEdges(nodes);\r\n\r\n\tvar numSearches = 0;\r\n\tvar siteswaps : number[][] = [];\r\n\tvar formattedSiteswaps : string[] = [];\r\n\r\n\tsearch(0, []);\t\r\n\r\n\treturn formattedSiteswaps;\r\n\r\n\tfunction search(origNodeIx : number, history : number[]) {\r\n\r\n\t\tnumSearches++;\t\r\n\t\tif (numSearches <= config.MaxSearches && siteswaps.length < config.MaxSiteswaps) {\r\n\r\n\t\t\tvar nextNodeIx = origNodeIx;\r\n\t\t\tvar validSiteswap = false;\r\n\t\t\tvar siteswapStartNode = undefined;\r\n\r\n\t\t\tif (history.length > 0 && history.length <= config.MaxPeriod) {\r\n\t\t\t\t\r\n\t\t\t\t// check if valid siteswap, ie. the last edge returns us to a node in the history\r\n\t\t\t\tif (history.length >= config.MinPeriod && (!config.Sync || history.length % 2 == 0)) {\r\n\t\t\t\t\tif (edges[last(history)].TargetNode == origNodeIx) {\r\n\t\t\t\t\t\tvalidSiteswap = true;\r\n\t\t\t\t\t\tsiteswapStartNode = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// excited siteswaps would return us to any node within the search (assuming the first node is the ground node)\r\n\t\t\t\t\t\tif (config.IncludeExcited) {\r\n\t\t\t\t\t\t\tfor (var i = 0; i < history.length; i++) {\r\n\t\t\t\t\t\t\t\tif (edges[last(history)].TargetNode == edges[history[i]].SourceNode && (!config.Sync || i % 2 == 0)) {\r\n\t\t\t\t\t\t\t\t\tvalidSiteswap = true;\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tsiteswapStartNode = i;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if the siteswap is valid check to see if it already exists, and if not, then add it to the list\r\n\t\t\t\tif (validSiteswap) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar siteswap = history.map(function (a,ix) {\r\n\t\t\t\t\t\tif (!config.Sync) {\r\n\t\t\t\t\t\t\treturn edges[a].Value; \r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar syncEdgeValue = \"\";\r\n\t\t\t\t\t\t\tvar asyncEdgeValue = edges[a].Value;\r\n\t\t\t\t\t\t\tfor (var i = 0; i < asyncEdgeValue.length; i++) {\r\n\t\t\t\t\t\t\t\tif (asyncEdgeValue[i] == \"[\" || asyncEdgeValue[i] == \"]\" || parseInt(asyncEdgeValue[i]) % 2 == 0 ) {\r\n\t\t\t\t\t\t\t\t\tsyncEdgeValue += asyncEdgeValue[i];\r\n\t\t\t\t\t\t\t\t} else if (ix % 2 == 0) {\r\n\t\t\t\t\t\t\t\t\tsyncEdgeValue += ((parseInt(asyncEdgeValue[i])-1)+\"x\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tsyncEdgeValue += ((parseInt(asyncEdgeValue[i])+1)+\"x\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn syncEdgeValue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).slice(siteswapStartNode);\r\n\r\n\t\t\t\t\tvar exists = false;\r\n\t\t\t\t\tfor (var i = 0; i < siteswaps.length; i++) {\r\n\t\t\t\t\t\tvar ssToMatch = siteswaps[i].map(function (a,ix) {\r\n\t\t\t\t\t\t\tif (!config.Sync) {\r\n\t\t\t\t\t\t\t\treturn edges[a].Value; \r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tvar syncEdgeValue = \"\";\r\n\t\t\t\t\t\t\t\tvar asyncEdgeValue = edges[a].Value;\r\n\t\t\t\t\t\t\t\tfor (var i = 0; i < asyncEdgeValue.length; i++) {\r\n\t\t\t\t\t\t\t\t\tif (asyncEdgeValue[i] == \"[\" || asyncEdgeValue[i] == \"]\" || parseInt(asyncEdgeValue[i]) % 2 == 0 ) {\r\n\t\t\t\t\t\t\t\t\t\tsyncEdgeValue += asyncEdgeValue[i];\r\n\t\t\t\t\t\t\t\t\t} else if (ix % 2 == 0) {\r\n\t\t\t\t\t\t\t\t\t\tsyncEdgeValue += ((parseInt(asyncEdgeValue[i])-1)+\"x\");\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tsyncEdgeValue += ((parseInt(asyncEdgeValue[i])+1)+\"x\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn syncEdgeValue;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (patternsMatch(ssToMatch,siteswap.slice())) {\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\texists = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!exists) {\r\n\t\t\t\t\t\t// the siteswaps array will actually store the edge history which can be converted into a siteswap string\r\n\t\t\t\t\t\tvar siteswapIx = siteswaps.push(history.slice(siteswapStartNode))-1;\r\n\t\t\t\t\t\tfor (var i = 0; i < siteswap.length; i++) {\r\n\t\t\t\t\t\t\tif (parseInt(siteswap[i]) > 9) {\r\n\t\t\t\t\t\t\t\tsiteswap[i] = String.fromCharCode(87+parseInt(siteswap[i]));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar formattedSiteswap = \"\";\r\n\t\t\t\t\t\tif (config.Sync) {\r\n\t\t\t\t\t\t\tfor (var i = 0; i < siteswap.length; i++) {\r\n\t\t\t\t\t\t\t\tif (i % 2 == 0) {\r\n\t\t\t\t\t\t\t\t\tformattedSiteswap += (\"(\" + siteswap[i] + \",\");\r\n\t\t\t\t\t\t\t\t} else { \r\n\t\t\t\t\t\t\t\t\tformattedSiteswap += (siteswap[i] + \")\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tformattedSiteswap = siteswap.join('');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tformattedSiteswaps.push(formattedSiteswap);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvalidSiteswap = true;\r\n\t\t\t\t}\r\n\t\t\t\tnextNodeIx = edges[last(history)].TargetNode;\r\n\t\t\t}\r\n\r\n\t\t\t// if the siteswap was invalid or it was valid but was excited, and we're still below the maxperiod for a siteswap, keep searching\r\n\t\t\tif ((!validSiteswap || siteswapStartNode! > 0) && history.length < config.MaxPeriod) {\r\n\r\n\t\t\t\t// search each edge of this next node\r\n\t\t\t\tnodes[nextNodeIx].Edges.map(function(edgeIx) {\r\n\r\n\t\t\t\t\t// was previously checking if we already visited the next node, but not doing that anymore since we're checking for excited swaps\r\n\t\t\t\t\tvar alreadyVisited = false;\r\n\r\n\t\t\t\t\t// check if searching this edge is going to match the exclusion pattern\r\n\t\t\t\t\t// TODO: need to fix this to search better\r\n\t\t\t\t\tvar exclude = false;\r\n\t\t\t\t\tfor (var j = 0; j < config.Exclude.length; j++) {\r\n\t\t\t\t\t\tif (config.Exclude[j] == edges[edgeIx].Value) {\r\n\t\t\t\t\t\t\texclude = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// if this is an odd numbered edge in the history and we're doing sync, this can't be a 1\r\n\t\t\t\t\tif (config.Sync && history.length % 2 == 0 && edges[edgeIx].Value.indexOf(\"1\") > -1) {\r\n\t\t\t\t\t\texclude = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// execute the search through the edge\r\n\t\t\t\t\tif (!alreadyVisited && !exclude) {\r\n\t\t\t\t\t\tvar newHistory = history.slice();\r\n\t\t\t\t\t\tnewHistory.push(edgeIx);\r\n\t\t\t\t\t\tsearch(origNodeIx,newHistory);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t}\t\t\t\t\r\n\r\n\t}\r\n\r\n\t// compare 2 siteswap patterns to check for equality\r\n\tfunction patternsMatch(p1 : string[], p2 : string[]) {\r\n\r\n\t\tif (p1.length != p2.length) {\r\n\t\t\treturn false;\r\n\t\t} else {\t\t\t\r\n\t\t\tfor (var i = 0; i <= p1.length; i++) {\r\n\t\t\t\tif (p1.toString() == p2.toString()) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\tp1.push(p1[0]);\r\n\t\t\t\tp1 = p1.slice(1);\t\r\n\t\t\t\tif (config.Sync) {\r\n\t\t\t\t\tp1.push(p1[0]);\r\n\t\t\t\t\tp1 = p1.slice(1);\r\n\t\t\t\t}\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}","/*\r\nInterfaces\r\n\r\nSiteswapSearch\r\n - Graph : SiteswapGraph\r\n  - Nodes : Node[]\r\n   - LandingSchedule : int[]\r\n   - Edges : int[]\r\n  - Edges : Edge[]\r\n   - SourceNode : int\r\n   - TargetNode : int\r\n   - Value: string\r\n - Siteswaps : Edge[][]\r\n - FormattedSiteswaps : string[]\r\n\r\nSiteswapSearchConfig\r\n - MinPeriod : int\r\n - Async : boolean\r\n - Callbacks : SiteswapSearchCallbacks // add callbacks later\r\n - Exclude : string[]\r\n - IncludeExcited : boolean\r\n - MaxSearches : int\r\n - MaxSiteswaps : int\r\n - Sync : boolean\r\n\r\n\r\n\r\nexports function SiteswapSearch(config) : SiteswapSearch\r\n\r\n - buildNodes\r\n - buildEdges\r\n - search\r\n*/\r\n\r\nexport interface Node {\r\n\tLandingSchedule: number[];\t\r\n\tEdges: number[]\r\n}\r\n\r\nexport function GetNodes(maxPeriod : number, numProps : number, includeMultiplex : boolean) : Node[] {\r\n\t\r\n\tvar nodes : Node[] = [];\r\n\r\n\tvar firstNode = {LandingSchedule:[], Edges:[]};\r\n\tvar options = [1,0];\r\n\tif (includeMultiplex) {\r\n\t\toptions.push(2);\r\n\t}\r\n\r\n\tbuildNodes(firstNode, options, false);\r\n\r\n\treturn nodes;\r\n\r\n\tfunction buildNodes(node : Node, options : number[], last : boolean) {\r\n\t\t// if the node we're constructing has reached the expected length\r\n\t\tif (node.LandingSchedule.length == maxPeriod) {\r\n\t\t\tif (node.LandingSchedule.reduce(function(a,b) { return a+b; }) == numProps) {\r\n\t\t\t\tnodes.push(node);\r\n\t\t\t}\t\t\t\r\n\t\t\t\r\n\t\t\t// if we've created all the nodes kick off the function to build the edges\r\n\t\t\tif (last) {\r\n\t\t\t\t//buildEdges();\r\n\t\t\t}\r\n\t\t\r\n\t\t} \r\n\t\t// if the node is not the expected length then we need to keep building\r\n\t\telse {\r\n\r\n\t\t\toptions.map(function(nodeOption,ix,nodeOptions) {\t\t\r\n\r\n\t\t\t\tvar newNode = {\r\n\t\t\t\t\tLandingSchedule : node.LandingSchedule.slice(),\r\n\t\t\t\t\tEdges: []\r\n\t\t\t\t}\t\t\t\r\n\t\t\t\tnewNode.LandingSchedule.push(nodeOption);\r\n\r\n\t\t\t\tvar propDiff = newNode.LandingSchedule.reduce(function(a,b) { return a+b; }) - numProps;\r\n\t\t\t\tvar newNodeOptions = [];\r\n\t\t\t\t\r\n\t\t\t\t// always have 1 first so the first node is the ground node\r\n\t\t\t\tif (propDiff == 0) {\r\n\t\t\t\t\tnewNodeOptions = [0];\r\n\t\t\t\t} else if (propDiff == 1) {\r\n\t\t\t\t\tnewNodeOptions = [1,0];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (includeMultiplex) {\r\n\t\t\t\t\t\tnewNodeOptions = [1,2,0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnewNodeOptions = [1,0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if (config.async) {\r\n\t\t\t\t// \tsetTimeout(buildNodes,0,newNode,newNodeOptions,last);\r\n\t\t\t\t// } else {\r\n\t\t\t\t\tbuildNodes(newNode,newNodeOptions,last && (ix == nodeOptions.length-1));\r\n\t\t\t\t//}\r\n\t\t\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t}\r\n\r\n}","import React, { Component } from 'react';\r\nimport { Siteswap } from '../simulator/Siteswap';\r\nimport { Pattern } from '../simulator/Pattern';\r\nimport { GetDwellPaths, DwellPath } from '../simulator/DwellPath';\r\nimport { PrimaryButton, Stack, TextField, MessageBar, MessageBarType, Modal, Label, Link, DefaultButton, Slider } from 'office-ui-fabric-react';\r\nimport 'office-ui-fabric-react/dist/css/fabric.css';\r\nimport * as Yaml from 'js-yaml';\r\nimport { FindRandomPattern } from '../search/RandomPattern';\r\n\r\ninterface Props {\r\n\tupdatePattern: Function\r\n}\r\n\r\nexport interface PatternSettings {\t\r\n\tsiteswap: string,\r\n\tbeatDuration: number,\r\n\tdwellPath: string,\r\n\tdwellRatio: number\r\n}\r\n\r\ninterface State {\r\n\tinput: string,\r\n\terrorMessage: string|null,\r\n\tshowSyntaxHelp: boolean\r\n}\r\n\r\nconst defaultPatternSettings : PatternSettings = {\t\r\n\tsiteswap: '3',\r\n\tbeatDuration: 0.24,\r\n\tdwellPath: \"(30)(10)\",\r\n\tdwellRatio: 0.8\r\n};\r\n\r\nexport class PatternSettingsControls extends Component<Props,State> {\r\n\r\n\tconstructor(props : Props) {\r\n\t\tsuper(props);\t\t\r\n\r\n\t\tthis.state = {\r\n\t\t\tinput: Yaml.safeDump(defaultPatternSettings).replace(/'/g,\"\"),\r\n\t\t\terrorMessage: null,\r\n\t\t\tshowSyntaxHelp: false\r\n\t\t};\r\n\t\r\n\t\t// This binding is necessary to make `this` work in the callback\t\t\r\n\t\tthis.updatePatternSettingsInput = this.updatePatternSettingsInput.bind(this);\r\n\t\tthis.juggleRandomPattern = this.juggleRandomPattern.bind(this);\r\n\t\tthis.juggleInputPattern = this.juggleInputPattern.bind(this);\r\n\t\tthis.juggle = this.juggle.bind(this);\r\n\t}\r\n\r\n\tprivate updatePatternSettingsInput(e : any) {\t\t\r\n\t\tthis.setState({\r\n\t\t\tinput: e.target.value\r\n\t\t});\r\n\t}\r\n\r\n\tprivate juggle(patternSettings : PatternSettings) {\r\n\t\ttry {\r\n\t\t\tvar siteswap = new Siteswap(patternSettings.siteswap.toString());\r\n\t\t\tvar pattern = new Pattern(siteswap, GetDwellPaths(patternSettings.dwellPath), patternSettings.dwellRatio, 1);\r\n\t\t\tpattern.Simulate(100,patternSettings.beatDuration);\r\n\t\t\t// lift pattern w/ simulation up to parent\r\n\t\t\tthis.props.updatePattern(pattern);\r\n\t\t\tthis.setState({\r\n\t\t\t\terrorMessage: null\r\n\t\t\t});\r\n\t\t} catch(e) {\r\n\t\t\tvar errorMessage : string;\r\n\t\t\tif (e.message) {\r\n\t\t\t\terrorMessage = e.message;\r\n\t\t\t} else {\r\n\t\t\t\t// fallback in case any exceptions were thrown as strings\r\n\t\t\t\terrorMessage = e;\r\n\t\t\t}\r\n\t\t\tthis.setState({errorMessage: errorMessage});\t\r\n\t\t}\r\n\t}\r\n\r\n\tprivate juggleRandomPattern() {\r\n\t\tvar patternSettings = FindRandomPattern();\r\n\t\tthis.setState({input: Yaml.safeDump(patternSettings).replace(/'/g,\"\")});\r\n\t\tthis.juggle(patternSettings);\r\n\t}\r\n\r\n\tprivate juggleInputPattern() {\r\n\t\tvar patternSettings : PatternSettings | undefined;\t\t\r\n\t\ttry {\r\n\t\t\tpatternSettings = Yaml.safeLoad(this.state.input);\r\n\t\t} catch (e) {\r\n\t\t\tthis.setState({errorMessage: \"Invalid pattern settings.\"});\r\n\t\t}\r\n\t\tif (patternSettings) {\r\n\t\t\tthis.juggle(patternSettings);\r\n\t\t}\t\t\r\n\t}\r\n\r\n\trender() {\t\t\r\n\t\treturn (\r\n\t\t\t<Stack>\t\t\t\t\r\n\t\t\t\t<MessageBar messageBarType={MessageBarType.info}>\r\n\t\t\t\t\tThis is a new version of Gunswap still in development. The old version is still available at <Link href=\"https://www.gunswap.co\">gunswap.co</Link>. Found a bug or have an enhancement idea? <Link href=\"https://github.com/yDgunz/gunswap/issues\">Open a ticket in Github</Link> or email me at <Link href=\"mailto:gunswapjuggling@gmail.com\">gunswapjuggling@gmail.com</Link>.\r\n\t\t\t\t</MessageBar>\r\n\t\t\t\t{this.state.errorMessage &&\r\n\t\t\t\t\t<MessageBar messageBarType={MessageBarType.severeWarning} isMultiline={false}>\r\n\t\t\t\t\t\t{this.state.errorMessage}\r\n\t\t\t \t \t</MessageBar>\r\n\t\t\t\t}\r\n\t\t\t\t<Stack horizontal>\r\n\t\t\t\t\t<PrimaryButton className=\"panel-main-button\" text=\"Juggle\" onClick={this.juggleInputPattern} />\r\n\t\t\t\t\t<DefaultButton className=\"panel-main-button\" text=\"Random Pattern\" onClick={this.juggleRandomPattern} />\t\r\n\t\t\t\t</Stack>\r\n\t\t\t\t<Label>Pattern Settings</Label>\r\n\t\t\t\t<TextField \r\n\t\t\t\t\tvalue={this.state.input} \r\n\t\t\t\t\tmultiline={true}\r\n\t\t\t\t\tonChange={this.updatePatternSettingsInput} \r\n\t\t\t\t\tautoAdjustHeight={true} />\r\n\t\t\t</Stack>\r\n\t\t);\r\n\t}\r\n\r\n}","import { Pattern } from \"../simulator/Pattern\";\r\nimport { FindSiteswaps } from \"./Search\";\r\nimport { Siteswap } from \"../simulator/Siteswap\";\r\nimport { DwellPath, GetDwellPaths } from \"../simulator/DwellPath\";\r\nimport { PatternSettings } from \"../ui/PatternSettings\";\r\n\r\n\r\nexport function FindRandomPattern() : PatternSettings {\r\n\t\r\n\tvar config = {\r\n\t\tNumProps: 3+Math.round(Math.random()),\r\n\t\tMinPeriod: 1,\r\n\t\tMaxPeriod: 6,\r\n\t\tIncludeMultiplex: false,\r\n\t\tIncludeExcited: true, // kept as false so we can string together patterns\r\n\t\tMaxSearches: 1000,\r\n\t\tMaxSiteswaps: 100,\r\n\t\tSync: Math.random() < 0.3,\r\n\t\tExclude: []\r\n\t}\r\n\r\n\tvar siteswaps = FindSiteswaps(config);\t\r\n\r\n\tvar dwellPathXPositions = [-20,-10,0,10,20,30];\r\n\tvar dwellPathYPositions = [0,0,10,20,20,30];\r\n\r\n\tvar dwellPathPositions : string[] = [];\r\n\tfor(var i = 0; i < dwellPathXPositions.length; i++) {\r\n\t\tfor(var j = 0; j < dwellPathYPositions.length; j++) {\r\n\t\t\tdwellPathPositions.push(`(${dwellPathXPositions[i]},${dwellPathYPositions[j]})`);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction findRandomPattern() : PatternSettings {\r\n\r\n\t\tvar siteswap = siteswaps[Math.floor(Math.random()*siteswaps.length)];\t\r\n\t\t\r\n\t\tvar dwellPaths = [];\r\n\t\tfor (var i = 0; i < 1+Math.round(Math.random()); i++) {\t\t\t\r\n\t\t\tvar dwellPath = \"\";\r\n\t\t\tfor (var j = 0; j < 1+Math.round(Math.random()); j++) {\r\n\t\t\t\tdwellPath += dwellPathPositions[Math.floor(Math.random()*dwellPathPositions.length)];\r\n\t\t\t}\r\n\t\t\tdwellPaths.push(dwellPath);\t\t\r\n\t\t}\r\n\t\r\n\t\tvar dwellPath = dwellPaths.join(\".\");\r\n\t\r\n\t\tvar dwellRatio = 0.8;\r\n\r\n\t\tvar s = new Siteswap(siteswap);\r\n\t\tvar d = GetDwellPaths(dwellPath);\r\n\t\tvar p = new Pattern(s, d, dwellRatio, 0);\t\r\n\t\r\n\t\tvar beatDuration = 0.2;\r\n\r\n\t\t// todo - should be able to call this w/ breakOnCollision = true\r\n\t\tvar hasCollision = p.Simulate(20,beatDuration,false);\r\n\r\n\t\tif (hasCollision) {\r\n\t\t\treturn findRandomPattern();\r\n\t\t} else {\r\n\t\t\treturn {\t\r\n\t\t\t\tsiteswap: siteswap,\r\n\t\t\t\tbeatDuration: beatDuration,\r\n\t\t\t\tdwellPath: dwellPath,\r\n\t\t\t\tdwellRatio: dwellRatio\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\t\r\n\treturn findRandomPattern();\r\n\r\n}","import * as THREE from \"three\";\r\nimport { Pattern } from \"../simulator/Pattern\";\r\nimport { Object3D } from \"three\";\r\nimport { vec3 } from \"@tlaukkan/tsm\";\r\nimport { ShoulderZOffset, ShoulderHeight, ArmHalfLength, ShoulderXOffset } from \"../simulator/JugglerConfig\";\r\n\r\nconst JugglerMeshMaterial = new THREE.MeshLambertMaterial( { color: 'grey' } );\r\n\r\ninterface JugglerMeshes {\r\n\tLeftHandMesh : THREE.Mesh;\r\n\tRightHandMesh : THREE.Mesh;\r\n\tLeftElbowMesh : THREE.Mesh;\r\n\tRightElbowMesh : THREE.Mesh;\r\n\tLeftShoulderMesh : THREE.Mesh;\r\n\tRightShoulderMesh : THREE.Mesh;\r\n\tLeftBicepMesh: THREE.Mesh;\r\n\tLeftForearmMesh: THREE.Mesh;\r\n\tRightBicepMesh: THREE.Mesh;\r\n\tRightForearmMesh: THREE.Mesh;\r\n\tLeftWristMesh: THREE.Mesh;\r\n\tRightWristMesh: THREE.Mesh;\r\n\tBodyMesh: THREE.Mesh;\r\n\tHeadMesh: THREE.Mesh;\r\n}\r\n\r\nexport class JugglingScene {\r\n\t\r\n\tprivate scene : THREE.Scene;\r\n\tprivate camera : THREE.PerspectiveCamera;\r\n\tprivate renderer : THREE.WebGLRenderer;\t\r\n\tprivate propMeshes : THREE.Mesh[];\r\n\tprivate jugglerMeshes : JugglerMeshes[];\r\n\tprivate camRadius : number;\r\n\tprivate camPhi : number;\r\n\tprivate camTheta : number;\r\n\tprivate startTime : number;\r\n\tpublic pattern : Pattern|null;\t\r\n\tprivate isMouseDown : boolean;\r\n\tprivate onMouseDownPosition : vec3;\r\n\tprivate onMouseDownTheta : number;\r\n\tprivate onMouseDownPhi : number;\r\n\tprivate positionToLookAt : vec3;\r\n\tpublic currentStep : number;\r\n\tpublic userControllingStep : boolean;\r\n\tpublic animationSpeed : number;\r\n\tpublic isPlaying : boolean;\r\n\r\n\tconstructor(container : HTMLDivElement, pattern : Pattern|null, width : number, height : number, animationSpeed: number) {\t\t\r\n\r\n\t\tthis.scene = new THREE.Scene();\r\n\t\tthis.camera = new THREE.PerspectiveCamera( 75, width/height, 0.1, 1000 );\r\n\t\tthis.positionToLookAt = new vec3();\t\r\n\t\t\r\n\t\tthis.renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\t\t\r\n\t\tthis.scene.add( new THREE.HemisphereLight(0xffffff, 0x000000, 1 ));\r\n\t\t//this.scene.background = new THREE.Color(\"white\");\r\n\r\n\t\tthis.propMeshes = [];\r\n\t\tthis.jugglerMeshes = [];\r\n\t\t\r\n\t\tthis.camRadius = 1;\r\n\t\tthis.camPhi = .3;\r\n\t\tthis.camTheta = Math.PI;\r\n\t\t\r\n\t\tthis.startTime = (new Date()).getTime();\r\n\t\t\r\n\t\tthis.pattern = pattern;\r\n\t\tif (pattern) {\r\n\t\t\tthis.UpdatePattern(pattern);\r\n\t\t}\r\n\t\t\r\n\t\tthis.isMouseDown = false;\r\n\t\tthis.onMouseDownPosition = new vec3();\r\n\t\tthis.onMouseDownTheta = 0;\r\n\t\tthis.onMouseDownPhi = 0;\r\n\t\tthis.userControllingStep = false;\r\n\t\tthis.currentStep = 0;\r\n\t\tthis.animationSpeed = animationSpeed;\r\n\t\tthis.isPlaying = true;\r\n\r\n\t\tthis.renderer.setSize(width, height);\r\n\r\n\t\tthis.renderer.domElement.addEventListener( 'mousemove', (event) => { \r\n\t\t\tthis.onDocumentMouseMove(event); \r\n\t\t}, false );\r\n\t\tthis.renderer.domElement.addEventListener( 'mousedown', (event) => {\r\n\t\t\tthis.onDocumentMouseDown(event);\r\n\t\t}, false );\r\n\t\tthis.renderer.domElement.addEventListener( 'mouseup', (event) => {\r\n\t\t\tthis.onDocumentMouseUp(event);\r\n\t\t}, false );\t\t\r\n\t\tthis.renderer.domElement.addEventListener( 'wheel', (event) => {\r\n\t\t\tthis.onDocumentMouseWheel(event);\r\n\t\t}, false );\r\n\t\tthis.renderer.domElement.addEventListener( 'touchmove', (event) => {\r\n\t\t\tthis.onDocumentTouchMove(event);\r\n\t\t}, false );\r\n\t\tthis.renderer.domElement.addEventListener( 'touchstart', (event) => {\r\n\t\t\tthis.onDocumentTouchStart(event);\r\n\t\t}, false );\r\n\t\tthis.renderer.domElement.addEventListener( 'touchmove', (event) => {\r\n\t\t\tthis.onDocumentTouchEnd(event);\r\n\t\t}, false );\r\n\t\t\r\n\t\tcontainer.append(this.renderer.domElement);\r\n\r\n\t\tthis.animate();\r\n\t} \r\n\r\n\tpublic UpdateStep(patternProgress : number) {\r\n\t\tthis.currentStep = Math.floor(this.pattern!.States.length*this.pattern!.Simulation!.NumStepsPerBeat*patternProgress);\r\n\t\tthis.userControllingStep = true;\r\n\t}\r\n\r\n\tpublic UpdatePattern(pattern : Pattern|null) {\r\n\t\tthis.pattern = pattern;\r\n\t\tif (pattern) {\r\n\t\t\tvar highestLowest = (pattern as Pattern).GetHeighestAndLowestPositionInSimulation();\r\n\t\t\tthis.positionToLookAt.y = highestLowest[0] - (highestLowest[0] - highestLowest[1])/2;\r\n\t\t\tthis.updateCamera();\r\n\t\t}\t\t\r\n\t}\r\n\r\n\tpublic Resize(width : number, height : number) {\r\n\t\tthis.renderer.setSize(width, height);\r\n\t\tthis.camera.aspect = width/height;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\t}\r\n\r\n\tprivate onDocumentMouseDown( event : MouseEvent ) {\r\n\t\tthis.isMouseDown = true;\r\n\t\tthis.onMouseDownTheta = this.camTheta;\r\n\t\tthis.onMouseDownPhi = this.camPhi;\r\n\t\tthis.onMouseDownPosition.x = event.clientX;\r\n\t\tthis.onMouseDownPosition.y = event.clientY;\r\n\t}\r\n\r\n\tprivate onDocumentTouchStart(event : TouchEvent) {\r\n\t\tthis.isMouseDown = true;\r\n\t\tthis.onMouseDownTheta = this.camTheta;\r\n\t\tthis.onMouseDownPhi = this.camPhi;\r\n\t\tthis.onMouseDownPosition.x = event.touches[0].clientX;\r\n\t\tthis.onMouseDownPosition.y = event.touches[0].clientY;\r\n\t}\r\n\r\n\tprivate onMove(x : number, y : number) {\r\n\t\tif ( this.isMouseDown ) {\r\n\t\t\tthis.camTheta = - ( ( x - this.onMouseDownPosition.x ) * 0.01 ) + this.onMouseDownTheta;\r\n\t\t\t\r\n\t\t\tvar dy = y - this.onMouseDownPosition.y;\r\n\t\t\t\r\n\t\t\tvar newCamPhi = ( ( dy ) * 0.01 ) + this.onMouseDownPhi;\r\n\r\n\t\t\tif (newCamPhi < Math.PI/2 && newCamPhi > -Math.PI/2) {\r\n\t\t\t\tthis.camPhi = newCamPhi;\r\n\t\t\t}\r\n\t\t\tthis.updateCamera();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onDocumentMouseMove(event : MouseEvent) {\r\n\t\tevent.preventDefault();\t\t\r\n\t\tthis.onMove(event.clientX, event.clientY);\r\n\t}\r\n\r\n\tprivate onDocumentTouchMove(event : TouchEvent) {\r\n\t\tevent.preventDefault();\r\n\t\tthis.onMove(event.touches[0].clientX, event.touches[0].clientY);\r\n\t}\r\n\r\n\tprivate onDocumentMouseUp( event : MouseEvent) {\r\n\t\tevent.preventDefault();\r\n\t\tthis.isMouseDown = false;\r\n\t}\r\n\r\n\tprivate onDocumentTouchEnd( event : TouchEvent) {\r\n\t\tevent.preventDefault();\r\n\t\tthis.isMouseDown = false;\r\n\t}\r\n\r\n\tprivate onDocumentMouseWheel(event : WheelEvent) {\r\n\t\tthis.camRadius += event.deltaY*.05;\r\n\t\tthis.updateCamera();\r\n\t}\r\n\r\n\t// TODO - account for multiple jugglers\r\n\tprivate updateCamera() {\r\n\t\tthis.camera.position.x = this.camRadius * Math.sin( this.camTheta ) * Math.cos( this.camPhi );\r\n\t\tthis.camera.position.y = this.camRadius * Math.sin( this.camPhi ) + this.positionToLookAt.y;\r\n\t\tthis.camera.position.z = this.camRadius * Math.cos( this.camTheta ) * Math.cos( this.camPhi );\r\n\r\n\t\tthis.camera.lookAt(this.positionToLookAt.x, this.positionToLookAt.y, this.positionToLookAt.z);\r\n\t}\r\n\r\n\tprivate animate() {\r\n\r\n\t\tif (this.pattern && this.pattern.Simulation && (this.isPlaying || this.userControllingStep)) {\t\t\t\r\n\r\n\t\t\tif (!this.userControllingStep) {\r\n\t\t\t\tvar timeElapsed = ((new Date()).getTime() - this.startTime);\r\n\t\t\r\n\t\t\t\tvar patternTimeElapsed = timeElapsed % (this.pattern.States.length*this.pattern.Simulation.BeatDuration*1000/this.animationSpeed); \r\n\t\t\t\tthis.currentStep = Math.floor(patternTimeElapsed/(this.pattern.States.length*this.pattern.Simulation.BeatDuration*1000/this.animationSpeed)*(this.pattern.Simulation.NumStepsPerBeat*this.pattern.States.length));\r\n\t\t\t}\r\n\r\n\t\t\t// if we need to, remove some meshes from the scene\r\n\t\t\twhile (this.pattern.Props.length < this.propMeshes.length) {\r\n\t\t\t\tvar meshToRemove = this.propMeshes.pop() as Object3D;\r\n\t\t\t\tthis.scene.remove(meshToRemove);\r\n\t\t\t}\r\n\r\n\t\t\t// need to create some meshes\r\n\t\t\twhile (this.pattern.Props.length > this.propMeshes.length) {\r\n\t\t\t\tvar geometry = new THREE.SphereGeometry( 0.05, 40 );\r\n\t\t\t\tvar material = new THREE.MeshLambertMaterial( { color: 0x00ff00 } );\r\n\t\t\t\tvar propMesh = new THREE.Mesh( geometry, material );\r\n\t\t\t\t\r\n\t\t\t\tthis.propMeshes.push( propMesh );\r\n\t\t\t\tthis.scene.add( propMesh );\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.propMeshes.forEach((mesh, propIx) => {\r\n\t\t\t\tvar position = this.pattern!.Simulation!.Props[propIx].Positions[this.currentStep];\r\n\t\t\t\tmesh.position.set(position.x, position.y, position.z);\r\n\t\t\t});\r\n\r\n\t\t\t// TODO - remove juggler meshes if necessary\r\n\t\t\twhile (this.pattern.Simulation.Jugglers.length > this.jugglerMeshes.length) {\t\t\t\t\r\n\t\t\t\tthis.addJugglerMeshes();\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tthis.jugglerMeshes.forEach((meshes, jugglerIx) => {\t\t\t\t\t\t\t\t\r\n\t\t\t\tvar jugglerPositions = this.pattern!.Simulation!.Jugglers[jugglerIx];\r\n\t\t\t\t\r\n\t\t\t\tmeshes.BodyMesh.position.set(\r\n\t\t\t\t\t-ShoulderZOffset*Math.sin(jugglerPositions.BodyRotations[this.currentStep]),\r\n\t\t\t\t\t(ShoulderHeight-.4/2),\r\n\t\t\t\t\tShoulderZOffset*Math.cos(jugglerPositions.BodyRotations[this.currentStep])\r\n\t\t\t\t);\r\n\t\t\t\tmeshes.BodyMesh.position.add(this.vec3ToTHREEVector3(jugglerPositions.BodyPositions[this.currentStep]));\r\n\r\n\t\t\t\tmeshes.HeadMesh.position.set(\r\n\t\t\t\t\t-ShoulderZOffset*Math.sin(jugglerPositions.BodyRotations[this.currentStep]),\r\n\t\t\t\t\t(ShoulderHeight+.17),\r\n\t\t\t\t\tShoulderZOffset*Math.cos(jugglerPositions.BodyRotations[this.currentStep])\r\n\t\t\t\t);\r\n\t\t\t\tmeshes.HeadMesh.position.add(this.vec3ToTHREEVector3(jugglerPositions.BodyPositions[this.currentStep]));\r\n\r\n\t\t\t\tvar leftShoulderPosition = new THREE.Vector3(\r\n\t\t\t\t\t-ShoulderXOffset*Math.cos(jugglerPositions.BodyRotations[this.currentStep])-ShoulderZOffset*Math.sin(jugglerPositions.BodyRotations[this.currentStep]),\r\n\t\t\t\t\t(ShoulderHeight),\r\n\t\t\t\t\t-ShoulderXOffset*Math.sin(jugglerPositions.BodyRotations[this.currentStep])+ShoulderZOffset*Math.cos(jugglerPositions.BodyRotations[this.currentStep])\r\n\t\t\t\t);\r\n\t\t\t\tleftShoulderPosition.add(this.vec3ToTHREEVector3(jugglerPositions.BodyPositions[this.currentStep]));\r\n\r\n\t\t\t\tvar rightShoulderPosition = new THREE.Vector3(\r\n\t\t\t\t\tShoulderXOffset*Math.cos(jugglerPositions.BodyRotations[this.currentStep])-ShoulderZOffset*Math.sin(jugglerPositions.BodyRotations[this.currentStep]),\r\n\t\t\t\t\t(ShoulderHeight),\r\n\t\t\t\t\tShoulderXOffset*Math.sin(jugglerPositions.BodyRotations[this.currentStep])+ShoulderZOffset*Math.cos(jugglerPositions.BodyRotations[this.currentStep])\r\n\t\t\t\t);\r\n\t\t\t\trightShoulderPosition.add(this.vec3ToTHREEVector3(jugglerPositions.BodyPositions[this.currentStep]));\r\n\r\n\t\t\t\tvar leftHandPosition = this.vec3ToTHREEVector3(jugglerPositions.LeftHandPositions[this.currentStep]);\r\n\t\t\t\tvar rightHandPosition = this.vec3ToTHREEVector3(jugglerPositions.RightHandPositions[this.currentStep]);\r\n\t\t\t\tvar leftElbowPosition = this.vec3ToTHREEVector3(jugglerPositions.LeftElbowPositions[this.currentStep]);\r\n\t\t\t\tvar rightElbowPosition = this.vec3ToTHREEVector3(jugglerPositions.RightElbowPositions[this.currentStep]);\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tmeshes.LeftHandMesh.position.copy(leftHandPosition);\r\n\t\t\t\tmeshes.RightHandMesh.position.copy(rightHandPosition);\r\n\t\t\t\tmeshes.LeftElbowMesh.position.copy(leftElbowPosition);\r\n\t\t\t\tmeshes.RightElbowMesh.position.copy(rightElbowPosition);\r\n\t\t\t\tmeshes.LeftShoulderMesh.position.copy(leftShoulderPosition);\r\n\t\t\t\tmeshes.RightShoulderMesh.position.copy(rightShoulderPosition);\r\n\r\n\t\t\t\tthis.positionAndRotateArm(leftElbowPosition, leftShoulderPosition, leftHandPosition, meshes.LeftBicepMesh, meshes.LeftForearmMesh, meshes.LeftWristMesh);\r\n\t\t\t\tthis.positionAndRotateArm(rightElbowPosition, rightShoulderPosition, rightHandPosition, meshes.RightBicepMesh, meshes.RightForearmMesh, meshes.RightWristMesh);\r\n\r\n\t\t\t\t// rotate hands\r\n\t\t\t\tvar rotation = new THREE.Quaternion();\r\n\t\t\t\trotation.setFromUnitVectors(new THREE.Vector3(0,1,0), this.vec3ToTHREEVector3(jugglerPositions.LeftHandDirections[this.currentStep]));\r\n\t\t\t\tmeshes.LeftHandMesh.setRotationFromQuaternion(rotation);\r\n\t\t\t\trotation.setFromUnitVectors(new THREE.Vector3(0,1,0), this.vec3ToTHREEVector3(jugglerPositions.RightHandDirections[this.currentStep]));\r\n\t\t\t\tmeshes.RightHandMesh.setRotationFromQuaternion(rotation);\r\n\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\trequestAnimationFrame( () => this.animate() );\r\n\t\tthis.renderer.render( this.scene, this.camera );\r\n\t}\r\n\r\n\tprivate vec3ToTHREEVector3(vec3 : vec3) : THREE.Vector3 {\r\n\t\treturn new THREE.Vector3(vec3.x, vec3.y, vec3.z);\r\n\t}\r\n\r\n\tprivate positionAndRotateArm(elbowPosition: THREE.Vector3, shoulderPosition: THREE.Vector3, handPosition: THREE.Vector3, bicepMesh : THREE.Mesh, forearmMesh: THREE.Mesh, wristMesh: THREE.Mesh) {\r\n\t\t// bicep\r\n\t\tvar armDirection = new THREE.Vector3().subVectors(elbowPosition, shoulderPosition);\r\n\t\tvar arrow = new THREE.ArrowHelper(armDirection.clone().normalize(), shoulderPosition);\r\n\t\tbicepMesh.rotation.setFromVector3(arrow.rotation.toVector3());\r\n\t\tvar newPosition = new THREE.Vector3().addVectors(shoulderPosition, armDirection.multiplyScalar(0.5));\r\n\t\tbicepMesh.position.copy(newPosition);\r\n\t\t\r\n\t\t// forearm\r\n\t\tarmDirection = new THREE.Vector3().subVectors(elbowPosition, handPosition);\r\n\t\tarrow = new THREE.ArrowHelper(armDirection.clone().normalize(), handPosition);\r\n\t\tforearmMesh.rotation.setFromVector3(arrow.rotation.toVector3());\r\n\t\tnewPosition = new THREE.Vector3().addVectors(handPosition, armDirection.multiplyScalar(0.5)).add(armDirection.clone().normalize().multiplyScalar(.04));\r\n\t\tforearmMesh.position.copy(newPosition);\r\n\r\n\t\t// wrist\r\n\t\tnewPosition = handPosition.clone().add(armDirection.clone().normalize().multiplyScalar(.08));\r\n\t\twristMesh.position.copy(newPosition);\r\n\t}\r\n\r\n\tprivate getHandMesh() : THREE.Mesh {\r\n\t\tvar geometry = new THREE.SphereBufferGeometry( 0.06, 20, 20, 0, Math.PI*2, Math.PI/2, Math.PI);\r\n\t\tvar material = new THREE.MeshPhongMaterial( { color: 'grey', side: THREE.DoubleSide, flatShading: true } );\r\n\t\treturn new THREE.Mesh( geometry, material );\r\n\t}\r\n\r\n\tprivate getJointMesh(radius : number) : THREE.Mesh {\r\n\t\tvar geometry = new THREE.SphereGeometry( radius, 20);\r\n\t\treturn new THREE.Mesh( geometry, JugglerMeshMaterial );\r\n\t}\r\n\r\n\tprivate getArmCylinder(radius1 : number, radius2: number, length: number) : THREE.Mesh {\t\t \r\n    \tvar cylinder = new THREE.CylinderGeometry( radius2, radius1, length, 20, 20 );\r\n    \treturn new THREE.Mesh( cylinder, JugglerMeshMaterial );\r\n\t}\r\n\r\n\tprivate addJugglerMeshes() {\r\n\t\tvar jugglerMeshes =  {\t\r\n\t\t\tLeftHandMesh: this.getHandMesh(),\r\n\t\t\tRightHandMesh: this.getHandMesh(),\r\n\t\t\tLeftElbowMesh: this.getJointMesh(.04),\r\n\t\t\tRightElbowMesh: this.getJointMesh(.04),\r\n\t\t\tLeftShoulderMesh: this.getJointMesh(.025),\r\n\t\t\tRightShoulderMesh: this.getJointMesh(.025),\r\n\t\t\tLeftWristMesh: this.getJointMesh(.02),\r\n\t\t\tRightWristMesh: this.getJointMesh(.02),\r\n\t\t\tLeftBicepMesh: this.getArmCylinder(.025, .04, ArmHalfLength),\r\n\t\t\tLeftForearmMesh: this.getArmCylinder(.02, .04, ArmHalfLength-0.09),\r\n\t\t\tRightBicepMesh: this.getArmCylinder(.025, .04, ArmHalfLength),\r\n\t\t\tRightForearmMesh: this.getArmCylinder(.02, .04, ArmHalfLength-0.09),\r\n\t\t\tBodyMesh: new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.05, .4, 20, 20, false), JugglerMeshMaterial),\r\n\t\t\tHeadMesh: new THREE.Mesh(new THREE.SphereBufferGeometry(.1, 20, 20), JugglerMeshMaterial)\r\n\t\t};\r\n\r\n\t\tthis.jugglerMeshes.push(jugglerMeshes);\r\n\r\n\t\tthis.scene.add(jugglerMeshes.LeftElbowMesh);\r\n\t\tthis.scene.add(jugglerMeshes.LeftHandMesh);\r\n\t\tthis.scene.add(jugglerMeshes.LeftShoulderMesh);\r\n\t\tthis.scene.add(jugglerMeshes.RightElbowMesh);\r\n\t\tthis.scene.add(jugglerMeshes.RightHandMesh);\r\n\t\tthis.scene.add(jugglerMeshes.RightShoulderMesh);\r\n\t\tthis.scene.add(jugglerMeshes.LeftBicepMesh);\r\n\t\tthis.scene.add(jugglerMeshes.LeftForearmMesh);\r\n\t\tthis.scene.add(jugglerMeshes.RightBicepMesh);\r\n\t\tthis.scene.add(jugglerMeshes.RightForearmMesh);\r\n\t\tthis.scene.add(jugglerMeshes.LeftWristMesh);\r\n\t\tthis.scene.add(jugglerMeshes.RightWristMesh);\r\n\t\tthis.scene.add(jugglerMeshes.BodyMesh);\r\n\t\tthis.scene.add(jugglerMeshes.HeadMesh);\r\n\t}\r\n\r\n}","import React, { Component, Ref } from 'react';\r\nimport * as THREE from \"three\";\r\nimport 'office-ui-fabric-react/dist/css/fabric.css';\r\nimport { Pattern } from '../simulator/Pattern';\r\nimport { JugglingScene } from './JugglingScene';\r\nimport { Slider, Stack, PrimaryButton, IconButton } from 'office-ui-fabric-react';\r\n\r\n\r\ninterface Props {\r\n\tpattern: Pattern\r\n}\r\n\r\ninterface State {\r\n\tdebugInfo: DebugInfo | null,\r\n\tuserControllingStep: boolean,\r\n\tisPlaying: boolean,\r\n\tanimationSpeed: number\r\n}\r\n\r\ninterface DebugInfo {\r\n\tstep: number\r\n}\r\n\r\nclass Viewport extends Component<Props,State> {\r\n\r\n\tCanvasContainerRef : HTMLDivElement | null;\r\n\r\n\tprivate jugglingScene : JugglingScene|undefined;\r\n\r\n\tconstructor(props : Props) {\r\n\t\tsuper(props);\t\t\r\n\t\tthis.CanvasContainerRef = null;\r\n\r\n\t\tthis.state = {\r\n\t\t\tdebugInfo: null,\r\n\t\t\tuserControllingStep: false,\r\n\t\t\tisPlaying: true,\r\n\t\t\tanimationSpeed: 0.5\r\n\t\t};\r\n\r\n\t\tthis.userUpdateStep = this.userUpdateStep.bind(this);\r\n\t\tthis.play = this.play.bind(this);\r\n\t\tthis.pause = this.pause.bind(this);\r\n\t}\t\t\r\n\r\n\tprivate play() {\r\n\t\tif (this.jugglingScene) {\r\n\t\t\tthis.jugglingScene.isPlaying = true;\r\n\t\t\tthis.jugglingScene.userControllingStep = false;\r\n\t\t\tthis.setState({isPlaying: true, userControllingStep: false});\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tprivate pause() {\r\n\t\tif (this.jugglingScene) {\r\n\t\t\tthis.jugglingScene.isPlaying = false;\r\n\t\t\tthis.setState({isPlaying: false});\r\n\t\t}\r\n\t}\r\n\r\n\tprivate userUpdateStep(sliderValue : number) {\r\n\t\tif (this.jugglingScene) {\r\n\t\t\tthis.jugglingScene.UpdateStep(sliderValue);\r\n\t\t\t\r\n\t\t\t this.setState({\r\n\t\t\t\t debugInfo: {step: this.jugglingScene!.currentStep},\r\n\t\t\t\t userControllingStep: true\r\n\t\t\t});\r\n\r\n\t\t}\t\t\r\n\t}\r\n\r\n\tcomponentDidUpdate() {\t\t\r\n\t\tif (this.jugglingScene && this.jugglingScene.pattern !== this.props.pattern) {\r\n\t\t\t// if the pattern changed then user is no longer controlling step\r\n\t\t\tthis.jugglingScene.userControllingStep = false;\r\n\t\t\tthis.jugglingScene.isPlaying = true;\r\n\t\t\tthis.setState({userControllingStep: false, debugInfo: null, isPlaying: true});\r\n\t\t\tthis.jugglingScene.UpdatePattern(this.props.pattern);\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\t\r\n\t\tvar width = (this.CanvasContainerRef as HTMLDivElement).offsetWidth;\r\n\t\tvar height = window.innerHeight-32; // subtracting size of button\r\n\t\tthis.jugglingScene = new JugglingScene(this.CanvasContainerRef as HTMLDivElement, this.props.pattern, width, height, this.state.animationSpeed);\r\n\r\n\t\t(window as any).jugglingScene = this.jugglingScene; // for debugging\r\n\r\n\t\twindow.addEventListener('resize', () => { \r\n\t\t\tif (this.CanvasContainerRef) {\r\n\t\t\t\tvar width = this.CanvasContainerRef.offsetWidth;\r\n\t\t\t\tvar height = window.innerHeight-32; // subtracting size of button\r\n\t\t\t\tif (this.jugglingScene) {\r\n\t\t\t\t\tthis.jugglingScene!.Resize(width, height); \r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t});\r\n\t}\r\n\r\n  \trender() {\r\n\t\tlet debug : JSX.Element = (<div></div>);\r\n\t\tif (this.state.debugInfo) {\r\n\t\t\tdebug = <div>{this.state.debugInfo.step}</div>\r\n\t\t}\r\n\r\n\t\tlet playbackButton;\r\n\t\tif (this.state.isPlaying && !this.state.userControllingStep) {\r\n\t\t\tplaybackButton = <IconButton iconProps={{iconName:\"Pause\"}} onClick={this.pause} />\r\n\t\t} else {\r\n\t\t\tplaybackButton = <IconButton iconProps={{iconName:\"Play\"}} onClick={this.play} />\t\t\t\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div>\t\t\t\t\r\n\t\t\t\t<div className=\"debug-info\">{debug}</div>\r\n\t\t\t\t<div ref={(DOMNodeRef) => {\r\n\t\t\t\t\tthis.CanvasContainerRef=DOMNodeRef;\r\n\t\t\t\t}}>\r\n\t\t\t\t</div>\r\n\t\t\t\t<Stack horizontal>\r\n\t\t\t\t\t{playbackButton}\r\n\t\t\t\t\t<Slider\r\n\t\t\t\t\t\tclassName=\"viewport-slider\"\r\n\t\t\t\t\t\tmin={0}\r\n\t\t\t\t\t\tmax={0.99}\r\n\t\t\t\t\t\tstep={.005}\r\n\t\t\t\t\t\tshowValue={false}\r\n\t\t\t\t\t\tonChange={(value: number) => this.userUpdateStep(value)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</Stack>\t\t\t\t\r\n\t\t\t</div>\t\t\t\r\n\t\t\t \r\n\t\t);\r\n  \t}\r\n}\r\n\r\nexport default Viewport;","import React, { Component, ReactNode } from 'react';\r\nimport { FindSiteswaps, FindSiteswapsConfig } from '../search/Search';\r\nimport { List, Stack, PrimaryButton, TextField, Label } from 'office-ui-fabric-react';\r\nimport * as Yaml from 'js-yaml';\r\n\r\ninterface State {\r\n\tSiteswaps : string[];\r\n\tInput: string\r\n}\r\n\r\nexport class Search extends Component<any,State> {\r\n\r\n\tconstructor(props : any) {\r\n\t\tsuper(props);\r\n\r\n\t\tvar defaultConfig : FindSiteswapsConfig = {\r\n\t\t\tNumProps: 3,\r\n\t\t\tMinPeriod: 1,\r\n\t\t\tMaxPeriod: 5,\t\t\t\r\n\t\t\tIncludeMultiplex: false,\r\n\t\t\tIncludeExcited: true,\r\n\t\t\tMaxSearches: 1000,\r\n\t\t\tMaxSiteswaps: 100,\r\n\t\t\tSync: false,\r\n\t\t\tExclude: []\r\n\t\t}\t\t\r\n\r\n\t\tthis.state = {\r\n\t\t\tSiteswaps: [],\r\n\t\t\tInput: Yaml.safeDump(defaultConfig),\r\n\t\t};\r\n\r\n\t\tthis.onRenderCell = this.onRenderCell.bind(this);\r\n\t\tthis.findSiteswaps = this.findSiteswaps.bind(this);\r\n\t\tthis.updateInput = this.updateInput.bind(this);\r\n\r\n\t}\r\n\r\n\tprivate findSiteswaps() {\r\n\t\tvar config : FindSiteswapsConfig | undefined;\r\n\t\ttry {\r\n\t\t\tconfig = Yaml.safeLoad(this.state.Input);\r\n\t\t} catch (e) {\r\n\t\t\t// TODO\r\n\t\t}\r\n\r\n\t\tif (config) {\r\n\t\t\tvar siteswaps = FindSiteswaps(config);\r\n\t\t\tthis.setState({Siteswaps: siteswaps});\r\n\t\t}\t\t\r\n\t}\t\r\n\r\n\tprivate onRenderCell(item?: string, index?: number | undefined): ReactNode {\r\n\t\treturn (\r\n\t\t\t<div id={index!.toString()}>\r\n\t\t\t\t{item}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tprivate updateInput(e : any) {\r\n\t\tthis.setState({\r\n\t\t\tInput: e.target.value\r\n\t\t});\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Stack>\r\n\t\t\t\t<PrimaryButton className=\"panel-main-button\" text=\"Find Siteswaps\" onClick={this.findSiteswaps} />\t\t\t\t\t\r\n\t\t\t\t<Label>Search Settings</Label>\r\n\t\t\t\t<TextField \r\n\t\t\t\t\tvalue={this.state.Input} \r\n\t\t\t\t\tmultiline={true}\r\n\t\t\t\t\tonChange={this.updateInput} \r\n\t\t\t\t\tautoAdjustHeight={true} />\r\n\t\t\t\t<List items={this.state.Siteswaps} onRenderCell={this.onRenderCell}></List>\r\n\t\t\t</Stack>\t\t\t\t\r\n\t\t)\r\n\t}\r\n\r\n}","import React, { Component } from 'react';\r\nimport { Siteswap } from '../simulator/Siteswap';\r\nimport { Pattern } from '../simulator/Pattern';\r\nimport { GetDwellPaths } from '../simulator/DwellPath';\r\nimport { PivotItem, Pivot } from 'office-ui-fabric-react/lib/Pivot';\r\nimport { PatternSettingsControls } from './PatternSettings';\r\nimport 'office-ui-fabric-react/dist/css/fabric.css';\r\nimport Viewport from './Viewport';\r\nimport { PatternSimulation } from '../simulator/PatternSimulation';\r\nimport { Slider } from 'office-ui-fabric-react';\r\nimport { Search } from './Search';\r\n\r\ninterface State {\r\n\tpattern: Pattern\r\n}\r\n\r\nclass Animator extends Component<any,State> {\r\n\r\n\tconstructor(props : any) {\r\n\t\tsuper(props);\t\t\r\n\r\n\t\tthis.state = {\r\n\t\t\tpattern: new Pattern(new Siteswap(\"3\"), GetDwellPaths(\"(30)(10)\"), 0.8, 0)\r\n\t\t}\r\n\r\n\t\tthis.state.pattern.Simulate(100,0.24);\r\n\r\n\t\twindow.onresize = () => {\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\r\n\t\tthis.updatePattern = this.updatePattern.bind(this);\r\n\t}\r\n\r\n\tprivate updatePattern(pattern : Pattern) {\r\n\t\tthis.setState({pattern: pattern});\r\n\t}\r\n\r\n  \trender() {\r\n\t\tlet patternSettings = <PatternSettingsControls updatePattern={this.updatePattern}></PatternSettingsControls>;\r\n\t\tlet search = <Search></Search>; \r\n\t\tlet viewport = <Viewport pattern={this.state.pattern} />;\r\n\t\t\r\n\t\tif (window.innerWidth > 900) {\r\n\t\t\treturn (\t\t\t\r\n\t\t\t\t<div className=\"ms-Grid\" dir=\"ltr\">\r\n\t\t\t\t\t<div className=\"ms-Grid-row\">\r\n\t\t\t\t\t\t<div className=\"ms-Grid-col ms-sm6 ms-md4 ms-lg4\">\r\n\t\t\t\t\t\t<Pivot >\r\n\t\t\t\t\t\t\t<PivotItem headerText=\"Pattern\" itemIcon=\"Settings\">\r\n\t\t\t\t\t\t\t\t{patternSettings}\r\n\t\t\t\t\t\t\t</PivotItem>\r\n\t\t\t\t\t\t\t<PivotItem headerText=\"Siteswaps\" itemIcon=\"Search\">\r\n\t\t\t\t\t\t\t\t{search}\r\n\t\t\t\t\t\t\t</PivotItem>\r\n\t\t\t\t\t\t</Pivot>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"ms-Grid-col ms-sm6 ms-md8 ms-lg8\">\r\n\t\t\t\t\t\t\t{viewport}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>      \t\t\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn (\r\n\t\t\t\t<Pivot >\r\n\t\t\t\t\t<PivotItem headerText=\"Animator\" itemIcon=\"Video\">\r\n\t\t\t\t\t\t{viewport}\r\n\t\t\t\t\t</PivotItem>\r\n\t\t\t\t\t<PivotItem headerText=\"Pattern\" itemIcon=\"Settings\">\r\n\t\t\t\t\t\t{patternSettings}\r\n\t\t\t\t\t</PivotItem>\r\n\t\t\t\t\t<PivotItem headerText=\"Siteswaps\" itemIcon=\"Search\">\r\n\t\t\t\t\t\t{search}\r\n\t\t\t\t\t</PivotItem>\t\t\t\t\t\r\n\t\t\t\t</Pivot>\r\n\t\t\t)\r\n\t\t}\r\n\r\n  \t}\r\n}\r\n\r\nexport default Animator;","import React from 'react';\nimport './App.css';\nimport Animator from './ui/Animator';\nimport { initializeIcons } from '@uifabric/icons';\ninitializeIcons();\n\nconst App: React.FC = () => {\n  \treturn (\n\t\t<Animator></Animator>\t\n  \t);\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}