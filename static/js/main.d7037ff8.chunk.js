(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{119:function(t,e,n){"use strict";n.r(e);var s,i,a,o,r=n(0),d=n.n(r),h=n(41),u=n.n(h),l=(n(91),n(92),n(8)),c=n(13),g=n(19),p=n(17),f=n(11),v=n(18),m="([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?",P="\\[("+m+")+\\]",S=m+"|"+P,w="\\(("+S+"),("+S+")\\)",y="("+S+"|"+w+")",M="<"+y+"(\\|"+y+")+>",T=new RegExp(m,"g"),C=new RegExp(P,"g"),x=new RegExp(S,"g"),B=new RegExp(w,"g"),L=new RegExp(y,"g"),E=new RegExp(M,"g"),H=new RegExp("^(<(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\]|\\((([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\]),(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\])\\))(\\|(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\]|\\((([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\]),(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\])\\)))+>)+|((([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\]|\\((([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\]),(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\])\\)))+\\*?$","g"),R=new RegExp("<(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\]|\\((([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\]),(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\])\\))+(\\|(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\]|\\((([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\]),(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?|\\[(([\\da-o])x?A?(P\\d?)?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?\\d*})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?)+\\])\\))+)+>","g"),D=n(4);!function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Any=2]="Any"}(s||(s={})),function(t){t[t.Force=0]="Force",t[t.HyperForce=1]="HyperForce",t[t.Lift=2]="Lift",t[t.HyperLift=3]="HyperLift",t[t.Any=4]="Any"}(i||(i={})),function(t){t[t.Standard=0]="Standard",t[t.Claw=1]="Claw",t[t.Penguin=2]="Penguin"}(a||(a={})),function(t){t[t.Standard=0]="Standard",t[t.Claw=1]="Claw",t[t.Penguin=2]="Penguin"}(o||(o={}));var b,F,j=new D.vec3([.1,.1,1]).normalize(),z=function t(e,n,r,d,h,u,c){Object(l.a)(this,t),this.Juggler=void 0,this.TargetJuggler=void 0,this.Hand=void 0,this.Crossing=void 0,this.NumBeats=void 0,this.Siteswap=void 0,this.NumBounces=void 0,this.BounceOrder=void 0,this.BounceType=void 0,this.NumSpins=void 0,this.DwellPath=void 0,this.DwellRatio=void 0,this.TossType=void 0,this.CatchType=void 0,this.TossOrientation=void 0,this.RotationAxis=void 0,this.Hold=void 0,this.Juggler=n,this.Hand=r,this.Siteswap=e,this.DwellPath=d;var g=e.match(T);if(!g||g.length>1)throw"Invalid toss string";this.NumBeats=e[0].charCodeAt(0)>=97&&e[0].charCodeAt(0)<=119?e[0].charCodeAt(0)-87:parseInt(e[0]),this.TargetJuggler=n;var p=!1,f=e.indexOf("P");f>0&&"}"!=e[f+1]&&(this.TargetJuggler=h>2?parseInt(e[f+1])-1:1-n,p=!0);var v=e.indexOf("D");this.DwellRatio=v>0?parseFloat(e.substring(v+2,e.indexOf("}"))):u,this.NumBounces=0,this.BounceOrder=[];var m=e.indexOf("B");if(m>0){var P=e.slice(m).search(/\d/)+m;if("{"==e[m+1]&&void 0!=P){this.NumBounces=parseInt(e[P]);for(var S=P+1;S<e.length&&!isNaN(e[S]);S++){var w=parseInt(e[S]);if(w>=c)throw"Bounce surface index out of range";this.BounceOrder.push(w)}}else this.NumBounces=1,this.BounceOrder=[0];if(this.BounceOrder.length<this.NumBounces){var y=this.NumBounces-this.BounceOrder.length;for(S=0;S<y;S++)this.BounceOrder.push(0)}}this.NumBounces>0&&(e.match("HF")?this.BounceType=i.HyperForce:e.match("HL")?this.BounceType=i.HyperLift:e.match("F")?this.BounceType=i.Force:e.match("L")?this.BounceType=i.Lift:this.BounceType=i.Any);var M=e.indexOf("T");if(this.TossType=a.Standard,M>0){var C=e.substring(M+2,e.indexOf("}",M));C.match("C")?this.TossType=a.Claw:C.match("P")&&(this.TossType=a.Penguin)}var x=e.indexOf("C");if(this.CatchType=o.Standard,x>0){var B=e.substring(x+2,e.indexOf("}",x));B.match("C")?this.CatchType=o.Claw:B.match("P")&&(this.CatchType=o.Penguin)}this.Crossing=this.NumBeats%2==1,e.length>1&&"x"==e[1]&&(this.Crossing=!this.Crossing),"R"==e[0]?this.Hand=s.Right:"L"==e[0]&&(this.Hand=s.Left),this.TossOrientation=j;var L=e.indexOf("S");if(L>0){var E=e.substring(L+2,e.indexOf("}",L)).match(/-?\d+(\.\d+)?/g);if(!E)throw"Invalid spin configuration";this.NumSpins=parseFloat(E[0]),E.length>1&&(this.TossOrientation=new D.vec3([parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])]).normalize())}else this.NumSpins=Math.floor(this.NumBeats/2)+.2,p&&(this.NumSpins+=.1);this.Hold=2==this.NumBeats&&!this.Crossing&&-1==e.indexOf("A"),this.RotationAxis=new D.vec3([1,0,0])},A=function(){function t(e){var n=this;if(Object(l.a)(this,t),this.Siteswap=void 0,this.Beats=void 0,this.IsSync=void 0,this.IsMultiplex=void 0,this.IsPassingPattern=void 0,this.NumJugglers=void 0,this.Siteswap=e.replace(/\s/g,""),this.NumJugglers=1,this.IsPassingPattern=/<[^ ]+>/.test(this.Siteswap),this.IsPassingPattern){var s=this.Siteswap.match(/<[^ <>]+>/g);if(s){if(this.NumJugglers=s[0].split("|").length,1==this.NumJugglers)throw new Error("Cannot have passing pattern with 1 juggler.");s.forEach(function(t){if(t.split("|").length!=n.NumJugglers)throw new Error("Each beat in passing siteswap must contain same number of jugglers")})}}var i=this.Siteswap.match(R);null!=i&&i[0]==this.Siteswap&&(this.Siteswap=this.transformPassingShorthand()),"*"==this.Siteswap.charAt(this.Siteswap.length-1)&&(this.Siteswap=this.transformSymmetricSyncShorthand());var a=this.Siteswap.match(H);if(null===a||a[0]!==this.Siteswap)throw"Invalid siteswap syntax.";this.IsMultiplex=!!this.Siteswap.match(C),this.IsSync=!!this.Siteswap.match(B);var o=this.IsPassingPattern?this.Siteswap.match(E):this.Siteswap.match(L);this.Beats=[],o&&o.forEach(function(t){n.Beats.push(t)});for(var r=0;r<this.Beats.length;r++)this.Beats[r].match(B)&&(this.Beats.splice(r+1,0,"(0,0)"),r++)}return Object(c.a)(t,[{key:"transformPassingShorthand",value:function(){for(var t="",e=this.Siteswap.split("|"),n=[],s=0;s<e.length;s++)n.push(e[s].match(L));for(s=0;s<n[0].length;s++){t+="<";for(var i=0;i<n.length;i++)t+=n[i][s],i<n.length-1&&(t+="|");t+=">"}return t}},{key:"transformSymmetricSyncShorthand",value:function(){var t=this.Siteswap.slice(0,-1),e=t.match(B);if(null!==e)for(var n=0;n<e.length;n++)t+="("+e[n].match(x).reverse().join(",")+")";return t}},{key:"GetTossCollection",value:function(t,e,n){var i=[],a=0,o=0;do{var r=this.Beats[a];++a==this.Beats.length&&(a=0);var d=[];(r.match(E)?r.match(L):[r]).forEach(function(i,a,r){var h=[];if(i.match(B)){var u=i.split(",");h.push({hand:s.Left,toss:u[0]}),h.push({hand:s.Right,toss:u[1]})}else h.push({hand:s.Any,toss:i});h.forEach(function(s){var i=t[o];++o==t.length&&(o=0),s.toss.match(T).forEach(function(h){var u=new z(h,a,s.hand,i,r.length,e,n);d.push(u),0==u.NumBeats&&--o<0&&(o=t.length-1)})})}),i.push(d)}while(0!=a||0!=o);return i}}]),t}(),O=n(78);(F=b||(b={}))[F.Ball=0]="Ball",F[F.Club=1]="Club",F[F.Ring=2]="Ring";var I=function(){function t(e,n,s,i){Object(l.a)(this,t),this.Id=e,this.PropType=n,this.C=s,this.Radius=i,this.TossSchedule=void 0,this.TossSchedule=[]}return Object(c.a)(t,[{key:"GetPreviousCurrentAndNextTossForBeat",value:function(t){for(var e=0;e<this.TossSchedule.length;e++){if(e==this.TossSchedule.length-1||this.TossSchedule[e].Beat<=t&&this.TossSchedule[e+1].Beat>t)return[0==e?this.TossSchedule[this.TossSchedule.length-1]:this.TossSchedule[e-1],this.TossSchedule[e],e==this.TossSchedule.length-1?this.TossSchedule[0]:this.TossSchedule[e+1]]}throw"Unable to determine previous, current, and next toss for beat"}}]),t}();function J(t,e,n,s,i,a,o,r){var d=t.Toss.DwellPath.GetPosition(1,t.Hand,new D.vec3,new D.vec3,0,0,null,i,a),h=e.Toss.DwellPath.GetPosition(0,e.Hand,new D.vec3,new D.vec3,0,0,null,o,r);return[new D.vec3([d.x+(h.x-d.x)*n/s,d.y+(h.y-d.y+4.9*s*s)*n/s-4.9*n*n,d.z+(h.z-d.z)*n/s]),new D.vec3([(h.x-d.x)/s,(h.y-d.y+4.9*s*s)/s-9.8*n,(h.z-d.z)/s])]}function k(t,e,n,s,i,a,o){var r;if(0==e)r=t[0];else if(1==e)r=t[t.length-1];else{1==t.length&&t.push(t[0]);var d=t[0].copy();d.add(n.copy().scale(i)),d.add(n.copy().normalize().scale(.1));var h=t[t.length-1].copy();h.add(s.copy().scale(-a)),h.add(s.copy().normalize().scale(-.1));for(var u=[d,h],l=[],c=[],g=0;g<t.length-1;g++){var p,f=t[g],v=t[g+1];if(0==g)P=u[0];else{var m=l[l.length-1],P=new D.vec3([f.x+(f.x-m.x),f.y+(f.y-m.y),f.z+(f.z-m.z)]);l.push(P)}if(g+1==t.length-1)p=u[1];else{var S=new D.vec3([(t[g].x+t[g+1].x)/2,(t[g].y+t[g+1].y)/2,(t[g].z+t[g+1].z)/2]),w=new D.vec3([(t[g+1].x+t[g+2].x)/2,(t[g+1].y+t[g+2].y)/2,(t[g+1].z+t[g+2].z)/2]),y=Math.sqrt(Math.pow(t[g].x-t[g+1].x,2)+Math.pow(t[g].y-t[g+1].y,2)+Math.pow(t[g].z-t[g+1].z,2)),M=y/(y+Math.sqrt(Math.pow(t[g+1].x-t[g+2].x,2)+Math.pow(t[g+1].y-t[g+2].y,2)+Math.pow(t[g+1].z-t[g+2].z,2))),T=new D.vec3([(1-M)*S.x+M*w.x,(1-M)*S.y+M*w.y,(1-M)*S.z+M*w.z]);p=new D.vec3([v.x+(S.x-T.x),v.y+(S.y-T.y),v.z+(S.z-T.z)]),l.push(p)}for(M=0;M<=1+1e-5;M+=.02)c.push(new D.vec3([Math.pow(1-M,3)*f.x+3*Math.pow(1-M,2)*M*P.x+3*(1-M)*Math.pow(M,2)*p.x+Math.pow(M,3)*v.x,Math.pow(1-M,3)*f.y+3*Math.pow(1-M,2)*M*P.y+3*(1-M)*Math.pow(M,2)*p.y+Math.pow(M,3)*v.y,Math.pow(1-M,3)*f.z+3*Math.pow(1-M,2)*M*P.z+3*(1-M)*Math.pow(M,2)*p.z+Math.pow(M,3)*v.z]))}var C=Math.floor(e*c.length);r=c[C<0?0:C]}return r}var N=1.05,V=function(){function t(e,n,i,a){Object(l.a)(this,t),this.Siteswap=e,this.DwellPaths=n,this.Props=void 0,this.TossCollection=void 0,this.States=void 0,this.Simulation=void 0,this.TossCollection=e.GetTossCollection(n,i,a);var o=0,r=this;if(e.Beats.map(function(t){if(t.match(E))for(var e=t.split("|"),n=0;n<e.length;n++)0==n&&(e[n]=e[n].substr(1)),n==e.length-1&&(e[n]=e[n].substr(0,e[n].length-1)),o+=r.sumThrows(e[n]);else o+=r.sumThrows(t)}),!(o/e.Beats.length%1==0&&o/e.Beats.length>0))throw"Cannot determine number of props";var d=o/e.Beats.length;this.Props=[];for(var h=0;h<d;h++)this.Props.push(new I(h,b.Ball,.5,.1));var u=0;this.TossCollection.forEach(function(t){t.forEach(function(t){t.NumBeats>u&&(u=t.NumBeats)})});var c=this.Props.slice(0);this.States=[];for(var g=[],p=0;p<e.NumJugglers;p++){g.push([[],[]]);for(var f=0;f<u;f++)g[p][s.Left].push(null),g[p][s.Right].push(null)}for(var v=!1,m=!1,P=0,S=s.Left;!v;){var w=[];if(g.forEach(function(t,e){var n=t[s.Left].shift();t[s.Left].push(null),n&&n.forEach(function(t){w.push({Prop:t,Juggler:e,Hand:s.Left})});var i=t[s.Right].shift();t[s.Right].push(null),i&&i.forEach(function(t){w.push({Prop:t,Juggler:e,Hand:s.Right})})}),this.TossCollection[P%this.TossCollection.length].forEach(function(t){for(var e=t.Hand==s.Any?S:t.Hand,n=t.Crossing?1-e:e,i=void 0,a=0;a<w.length;a++){var o=w[a];if(o.Hand==e&&o.Juggler==t.Juggler){if(0==t.NumBeats)throw"Prop landing on 0 toss at beat ".concat(P);i=o.Prop,w.splice(a,1);break}}if(void 0===i&&t.NumBeats>0&&(i=c.shift()),void 0===i&&t.NumBeats>0)throw"No prop available to toss at beat ".concat(P);t.NumBeats>0&&(m&&i.TossSchedule.push({Toss:t,Beat:P,Hand:e}),g[t.TargetJuggler][n][t.NumBeats-1]?g[t.TargetJuggler][n][t.NumBeats-1].push(i):g[t.TargetJuggler][n][t.NumBeats-1]=[i])}),m?P%this.TossCollection.length==0&&JSON.stringify(this.States[0],["Id"])==JSON.stringify(g,["Id"])?(v=!0,this.Props.forEach(function(t){t.TossSchedule[t.TossSchedule.length-1].Beat==P&&t.TossSchedule.pop()})):this.States.push(JSON.parse(JSON.stringify(g,["Id"]))):0==c.length&&(P+1)%this.TossCollection.length==0&&(m=!0,P=-1,this.States=[]),S=1-S,++P>1e3)throw"Pattern took more than 1000 beats to repeat states"}}return Object(c.a)(t,[{key:"sumThrows",value:function(t){for(var e=0,n=0;n<t.length;n++)parseInt(t[n])?e+=parseInt(t[n]):t.charCodeAt(n)>=97&&t.charCodeAt(n)<=119&&(e+=t.charCodeAt(n)-87),"P"!=t[n]&&"S"!=t[n]||!parseInt(t[n+1])||n++,"B"!=t[n]&&"D"!=t[n]&&"T"!=t[n]&&"C"!=t[n]&&"S"!=t[n]||"{"!=t[n+1]||(n=t.indexOf("}",n));return e}},{key:"Simulate",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.States.length,o=a*t,r=!1,d={Props:[],Jugglers:[],BeatDuration:e,NumStepsPerBeat:t};this.Props.forEach(function(t){return d.Props.push({Positions:[],Rotations:[]})}),this.States[0].forEach(function(t,e,n){var s,i;if(1==n.length)s=new D.vec3([0,0,0]),i=0;else{i=e/n.length*Math.PI*2,s=new D.vec3([-1*Math.sin(i),0,1*Math.cos(i)])}d.Jugglers.push({BodyPositions:Array(o).fill(s),BodyRotations:Array(o).fill(i),LeftHandPositions:[],RightHandPositions:[],LeftElbowPositions:[],RightElbowPositions:[],LeftHandDirections:[],RightHandDirections:[]})});for(var h=0;h<o;h++){var u=Math.floor(h*a/o),l=e*h*a/o;this.Props.forEach(function(t,n){var i,o,r,c=t.GetPreviousCurrentAndNextTossForBeat(u),g=Object(O.a)(c,3);i=g[0],o=g[1],r=g[2];var p=l,f=i.Beat;f>=o.Beat&&(f-=a);var v=r.Beat,m=o.Beat;v<=o.Beat&&(f-=a,m-=a);var P=m*e+o.Toss.DwellRatio*e,S=v*e,w=f*e+i.Toss.DwellRatio*e,y=m*e;p>=S&&(p-=a*e);var M=d.Jugglers[i.Toss.Juggler].BodyPositions[h],T=d.Jugglers[i.Toss.Juggler].BodyRotations[h],C=d.Jugglers[o.Toss.Juggler].BodyPositions[h],x=d.Jugglers[o.Toss.Juggler].BodyRotations[h],B=d.Jugglers[r.Toss.Juggler].BodyPositions[h],L=d.Jugglers[r.Toss.Juggler].BodyRotations[h];if(p<P||o.Toss.Hold){var E=y-w,H=J(i,o,E,E,M,T,C,x)[1],R=J(o,r,0,S-P,C,x,B,L)[1];if(o.Toss.Hold)var D=1-(S-p)/(S-y);else D=1-(P-p)/(P-y);var b=o.Toss.DwellPath.GetPosition(D,o.Hand,H,R,.01,.015,o.Toss.Hold?r.Toss.DwellPath.Snapshots[0]:null,C,x);d.Props[n].Positions.push(b);var F=H.copy().normalize().scale(D-1);F.add(R.copy().normalize().scale(D)),o.Hand===s.Left?(d.Jugglers[o.Toss.Juggler].LeftHandPositions[h]=b,d.Jugglers[o.Toss.Juggler].LeftHandDirections[h]=F):(d.Jugglers[o.Toss.Juggler].RightHandPositions[h]=b,d.Jugglers[o.Toss.Juggler].RightHandDirections[h]=F)}else{b=J(o,r,D=p-P,S-P,C,x,B,L)[0];d.Props[n].Positions.push(b)}});for(var c=0;c<this.Props.length;c++)for(var g=c+1;g<this.Props.length;g++){var p=d.Props[c].Positions[h],f=d.Props[g].Positions[h],v=D.vec3.distance(p,f);if(v<this.Props[c].Radius||v<this.Props[g].Radius){if(i)return!1;r=!0}}d.Jugglers.forEach(function(t,i){[s.Left,s.Right].forEach(function(o){if(o===s.Left&&void 0===t.LeftHandPositions[h]||o===s.Right&&void 0===t.RightHandPositions[h]){var r,c,g=0;n.Props.forEach(function(t){t.TossSchedule.forEach(function(t){var e=t.Beat;e<=u&&(e+=a),e>u&&t.Toss.Juggler==i&&t.Hand==o&&(void 0===r||e<g)&&(r=t,g=e)})});var p,f,v=0;if(n.Props.forEach(function(t){t.TossSchedule.forEach(function(t){var e=t.Beat;e>u&&(e-=a),e<=u&&t.Toss.Juggler==i&&t.Hand==o&&(void 0===c||e>v)&&(c=t,v=e)})}),void 0===c||void 0===r)p=new D.vec3([.3*o==s.Left?-1:1,N,0]),f=new D.vec3([0,1,0]);else{var m,P,S=[];S.push(c.Toss.DwellPath.Snapshots[c.Toss.DwellPath.Snapshots.length-1].Position.copy()),S.push(r.Toss.DwellPath.Snapshots[0].Position.copy()),n.Props.forEach(function(t){t.TossSchedule.forEach(function(t,e,n){t.Hand===o&&t.Beat===r.Beat&&t.Toss.Juggler===i&&(m=0==e?n[n.length-1]:n[e-1])})}),n.Props.forEach(function(t){t.TossSchedule.forEach(function(t,e,n){t===c&&(P=e===n.length-1?n[0]:n[e+1])})});var w=t.BodyPositions[h],y=t.BodyRotations[h],M=d.Jugglers[c.Toss.TargetJuggler].BodyPositions[h],T=d.Jugglers[c.Toss.TargetJuggler].BodyRotations[h],C=d.Jugglers[m.Toss.Juggler].BodyPositions[h],x=d.Jugglers[m.Toss.Juggler].BodyRotations[h],B=J(c,P,0,c.Toss.NumBeats*e,w,y,M,T)[1],L=J(m,r,m.Toss.NumBeats*e-m.Toss.DwellRatio*e,m.Toss.NumBeats*e-m.Toss.DwellRatio*e,C,x,w,y)[1];o===s.Left&&S.forEach(function(t){return t.x*=-1});var E=l;E>g*e&&(E-=a*e);var H=g*e-(v*e+c.Toss.DwellRatio*e),R=(E-(v*e+c.Toss.DwellRatio*e))/H;R<0&&(R=1),R>1&&(R=0);for(var b=0;b<S.length;b++){var F=S[b].copy();S[b].x=F.x*Math.cos(y)-F.z*Math.sin(y),S[b].y=F.y+N,S[b].z=F.x*Math.sin(y)+F.z*Math.cos(y),S[b].add(w)}p=k(S,R,B,L,.01,.01),(f=B.copy().normalize().scale(1-R)).add(L.copy().normalize().scale(-R))}o===s.Left?(t.LeftHandPositions[h]=p,t.LeftHandDirections[h]=f):(t.RightHandPositions[h]=p,t.RightHandDirections[h]=f)}var j=t.BodyRotations[h],z=t.BodyPositions[h],A=.225*(o===s.Left?-1:1),O=new D.vec3([z.x+(A*Math.cos(j)-.25*Math.sin(j)),1.425,z.z+(A*Math.sin(j)+.25*Math.cos(j))]),I=n.getElbowPosition(O,o===s.Left?t.LeftHandPositions[h]:t.RightHandPositions[h],.2,o);o===s.Left?t.LeftElbowPositions[h]=I:t.RightElbowPositions[h]=I})})}return this.Simulation=d,r}},{key:"getElbowPosition",value:function(t,e,n,s){var i=.3;n*=-1;var a=new D.vec3;a.x=e.x-t.x,a.y=e.y-t.y,a.z=e.z-t.z;var o=new D.vec3;o.x=Math.sqrt(a.x*a.x+a.z*a.z),o.y=a.y,o.z=0;var r=Math.atan2(a.z,a.x),d=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);2*i<d&&(i=d/2);var h=new D.vec3;h.x=o.y/d,h.y=-o.x/d,h.z=0;var u=new D.vec3([0,0,0]);u.z=1==s?-1:1;var l=Math.sqrt(i*i-.25*d*d),c=new D.vec3;c.x=o.x/2+l*h.x*Math.cos(n)+l*u.x*Math.sin(n),c.y=o.y/2+l*h.y*Math.cos(n)+l*u.y*Math.sin(n),c.z=o.z/2+l*h.z*Math.cos(n)+l*u.z*Math.sin(n);var g=new D.vec3;g.x=c.x*Math.cos(r)-c.z*Math.sin(r),g.y=c.y,g.z=c.x*Math.sin(r)+c.z*Math.cos(r);var p=new D.vec3;return p.x=g.x+t.x,p.y=g.y+t.y,p.z=g.z+t.z,p}},{key:"GetHeighestAndLowestPositionInSimulation",value:function(){var t=N,e=N;return this.Simulation&&this.Simulation.Props.forEach(function(n){n.Positions.forEach(function(n){n.y>t&&(t=n.y),n.y<e&&(e=n.y)})}),[t,e]}}]),t}(),G=(new D.vec4([4,0,1,Math.PI/2]),new D.vec4([0,1,0,Math.PI/2]),new D.vec4([0,0,0,0])),U=function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G;Object(l.a)(this,t),this.Position=void 0,this.Rotation=void 0,this.Empty=void 0,this.Empty=n;var i=e.match(/\(-?\d+(\.\d+)?(,-?\d+(\.\d+)?)?(,-?\d+(\.\d+)?)?/g);if(!i)throw"Could not find position for dwell path snapshot.";var a=i[0].match(/-?\d+(\.\d+)?/g);if(!a)throw"Could not find position for dwell path snapshot.";this.Position=new D.vec3([parseFloat(a[0])/100,a[1]?parseFloat(a[1])/100:0,a[2]?parseFloat(a[2])/100:0]);var o=e.match(/\{-?\d+(\.\d+)?,-?\d+(\.\d+)?,-?\d+(\.\d+)?,-?\d+(\.\d+)?\}/g);if(o){var r=o[0].match(/-?\d+(\.\d+)?/g);if(!r||4!=r.length)throw"Could not find 4 rotation values";this.Rotation=new D.vec4([parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])])}else this.Rotation=s},W=function(){function t(e){var n=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G;Object(l.a)(this,t),this.Snapshots=void 0,this.Snapshots=[],-1==e.indexOf("e")&&(e+="e");var i=/\(-?\d+(\.\d+)?(,-?\d+(\.\d+)?)?(,-?\d+(\.\d+)?)?(,\{-?\d+(\.\d+)?,-?\d+(\.\d+)?,-?\d+(\.\d+)?,-?\d+(\.\d+)?\})?\)/g,a=e.split("e")[0].match(i),o=e.split("e")[1].match(i);if(!a)throw new Error("Invalid dwell path");a.forEach(function(t){n.Snapshots.push(new U(t,!1,s))}),o&&o.forEach(function(t){n.Snapshots.push(new U(t,!0,s))})}return Object(c.a)(t,[{key:"GetPosition",value:function(t,e,n,s,i,a,o,r,d){var h=this.Snapshots.map(function(t){return q(t,e,r,d)});o&&h.push(q(o,e,r,d));new D.vec3;return 0==t?h[0].copy():1==t?h[h.length-1].copy():k(h,t,n,s,i,a)}}]),t}();function q(t,e,n,i){var a=t.Position.copy();return e==s.Left&&(a.x*=-1),a.y+=N,a.x=a.x*Math.cos(i)-a.z*Math.sin(i),a.z=a.x*Math.sin(i)+a.z*Math.cos(i),a.add(n),a}function Y(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var e=t.split(").").map(function(t,e,n){return e<n.length-1?t+")":t});if(e)return e.map(function(t){return new W(t)});throw new Error("Could not determine dwell paths")}var X=n(143),Q=n(76),$=n(141),K=n(150),Z=n(6),_=n(147),tt=n(140),et=n(79),nt=n(148),st=n(144),it=(n(53),n(25));function at(t,e){var n="",s=t.LandingSchedule[0],i=t.LandingSchedule.slice(1,e.LandingSchedule.length);i.push(0);var a=!1;0==s?n="0":s>1&&(a=!0,n="[");for(var o=0;o<i.length;o++){var r=o+1,d=r.toString();if(r>9&&(d=String.fromCharCode(87+r)),i[o]!=e.LandingSchedule[o]){if(!(s>=e.LandingSchedule[o]-i[o]))return null;n+=d,1==--s&&e.LandingSchedule[o]-i[o]==2&&(n+=d,s--)}}return a&&(n+="]"),n}function ot(t){return t[t.length-1]}function rt(t){var e=function(t,e,n){var s=[],i=[1,0];return n&&i.push(2),function i(a,o,r){a.LandingSchedule.length==t?a.LandingSchedule.reduce(function(t,e){return t+e})==e&&s.push(a):o.map(function(t,s,o){var d={LandingSchedule:a.LandingSchedule.slice(),Edges:[]};d.LandingSchedule.push(t);var h=d.LandingSchedule.reduce(function(t,e){return t+e})-e;i(d,0==h?[0]:1==h?[1,0]:n?[1,2,0]:[1,0],r&&s==o.length-1)})}({LandingSchedule:[],Edges:[]},i,!1),s}(t.maxPeriod,t.numProps,t.includeMultiplex),n=function(t){for(var e=[],n=0;n<t.length;n++)for(var s=0;s<t.length;s++){var i=at(t[n],t[s]);i&&t[n].Edges.push(e.push({SourceNode:n,TargetNode:s,Value:i})-1)}return e}(e),s=0,i=[],a=[];return function r(d,h){s++;if(s<=t.maxSearches&&i.length<t.maxSiteswaps){var u=d,l=!1,c=void 0;if(h.length>0&&h.length<=t.maxPeriod){if(h.length>=t.minPeriod&&(!t.sync||h.length%2==0))if(n[ot(h)].TargetNode==d)l=!0,c=0;else if(t.includeExcited)for(var g=0;g<h.length;g++)n[ot(h)].TargetNode!=n[h[g]].SourceNode||t.sync&&g%2!=0||(l=!0,c=g);if(l){for(var p=h.map(function(e,s){if(t.sync){for(var i="",a=n[e].Value,o=0;o<a.length;o++)"["==a[o]||"]"==a[o]||parseInt(a[o])%2==0?i+=a[o]:i+=s%2==0?parseInt(a[o])-1+"x":parseInt(a[o])+1+"x";return i}return n[e].Value}).slice(c),f=!1,g=0;g<i.length;g++){var v=i[g].map(function(e,s){if(t.sync){for(var i="",a=n[e].Value,o=0;o<a.length;o++)"["==a[o]||"]"==a[o]||parseInt(a[o])%2==0?i+=a[o]:i+=s%2==0?parseInt(a[o])-1+"x":parseInt(a[o])+1+"x";return i}return n[e].Value});if(o(v,p.slice())){f=!0;break}}if(!f){i.push(h.slice(c));for(var g=0;g<p.length;g++)parseInt(p[g])>9&&(p[g]=String.fromCharCode(87+parseInt(p[g])));var m="";if(t.sync)for(var g=0;g<p.length;g++)m+=g%2==0?"("+p[g]+",":p[g]+")";else m=p.join("");a.push(m)}l=!0}u=n[ot(h)].TargetNode}(!l||c>0)&&h.length<t.maxPeriod&&e[u].Edges.map(function(e){for(var s=!1,i=0;i<t.exclude.length;i++)if(t.exclude[i]==n[e].Value){s=!0;break}if(t.sync&&h.length%2==0&&n[e].Value.indexOf("1")>-1&&(s=!0),!s){var a=h.slice();a.push(e),r(d,a)}})}}(0,[]),a;function o(e,n){if(e.length!=n.length)return!1;for(var s=0;s<=e.length;s++){if(e.toString()==n.toString())return!0;e.push(e[0]),e=e.slice(1),t.sync&&(e.push(e[0]),e=e.slice(1))}}}var dt=function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(g.a)(this,Object(p.a)(e).call(this,t))).state={input:it.safeDump(n.props.patternSettings).replace(/'/g,""),errorMessage:null,showSyntaxHelp:!1},n.updatePatternSettingsInput=n.updatePatternSettingsInput.bind(Object(f.a)(n)),n.juggleRandomPattern=n.juggleRandomPattern.bind(Object(f.a)(n)),n.juggleInputPattern=n.juggleInputPattern.bind(Object(f.a)(n)),n.juggle=n.juggle.bind(Object(f.a)(n)),n}return Object(v.a)(e,t),Object(c.a)(e,[{key:"updatePatternSettingsInput",value:function(t){this.setState({input:t.target.value})}},{key:"juggle",value:function(t){try{var e=new A(t.siteswap.toString()),n=new V(e,Y(t.dwellPath),t.dwellRatio,1);n.Simulate(100,t.beatDuration),this.props.updatePattern(n,t),this.setState({errorMessage:null})}catch(i){var s;s=i.message?i.message:i,this.setState({errorMessage:s})}}},{key:"juggleRandomPattern",value:function(){var t=function(){for(var t=rt({numProps:3+Math.round(Math.random()),minPeriod:1,maxPeriod:6,includeMultiplex:!1,includeExcited:!0,maxSearches:1e3,maxSiteswaps:100,sync:Math.random()<.3,exclude:[]}),e=[-20,-10,0,10,20,30],n=[0,0,10,20,20,30],s=[],i=0;i<e.length;i++)for(var a=0;a<n.length;a++)s.push("(".concat(e[i],",").concat(n[a],")"));return function e(){for(var n=t[Math.floor(Math.random()*t.length)],i=[],a=0;a<1+Math.round(Math.random());a++){for(var o="",r=0;r<1+Math.round(Math.random());r++)o+=s[Math.floor(Math.random()*s.length)];i.push(o)}o=i.join(".");var d=new A(n),h=Y(o);return new V(d,h,.8,0).Simulate(20,.2,!1)?e():{siteswap:n,beatDuration:.2,dwellPath:o,dwellRatio:.8}}()}();this.setState({input:it.safeDump(t).replace(/'/g,"")}),this.juggle(t)}},{key:"juggleInputPattern",value:function(){var t;try{t=it.safeLoad(this.state.input)}catch(e){this.setState({errorMessage:"Invalid pattern settings."})}t&&this.juggle(t)}},{key:"render",value:function(){return d.a.createElement($.a,null,d.a.createElement(K.a,{messageBarType:Z.a.info},"This is a new version of Gunswap still in development. The old version is still available at ",d.a.createElement(_.a,{href:"https://www.gunswap.co"},"gunswap.co"),". Found a bug or have an enhancement idea? ",d.a.createElement(_.a,{href:"https://github.com/yDgunz/gunswap/issues"},"Open a ticket in Github")," or email me at ",d.a.createElement(_.a,{href:"mailto:gunswapjuggling@gmail.com"},"gunswapjuggling@gmail.com"),"."),this.state.errorMessage&&d.a.createElement(K.a,{messageBarType:Z.a.severeWarning,isMultiline:!1},this.state.errorMessage),d.a.createElement($.a,{horizontal:!0},d.a.createElement(tt.a,{className:"panel-main-button",text:"Juggle",onClick:this.juggleInputPattern}),d.a.createElement(et.a,{className:"panel-main-button",text:"Random Pattern",onClick:this.juggleRandomPattern})),d.a.createElement(nt.a,null,"Pattern Settings"),d.a.createElement(st.a,{value:this.state.input,multiline:!0,onChange:this.updatePatternSettingsInput,autoAdjustHeight:!0}))}}]),e}(r.Component),ht=n(5),ut=new ht.f({color:"grey"}),lt=function(){function t(e,n,s,i,a){var o=this;Object(l.a)(this,t),this.scene=void 0,this.camera=void 0,this.renderer=void 0,this.propMeshes=void 0,this.jugglerMeshes=void 0,this.camRadius=void 0,this.camPhi=void 0,this.camTheta=void 0,this.startTime=void 0,this.pattern=void 0,this.isMouseDown=void 0,this.onMouseDownPosition=void 0,this.onMouseDownTheta=void 0,this.onMouseDownPhi=void 0,this.positionToLookAt=void 0,this.currentStep=void 0,this.userControllingStep=void 0,this.animationSpeed=void 0,this.isPlaying=void 0,this.scene=new ht.j,this.camera=new ht.h(75,s/i,.1,1e3),this.positionToLookAt=new D.vec3,this.renderer=new ht.n({antialias:!0}),this.scene.add(new ht.d(16777215,0,1)),this.propMeshes=[],this.jugglerMeshes=[],this.camRadius=1,this.camPhi=.3,this.camTheta=Math.PI,this.startTime=(new Date).getTime(),this.pattern=n,n&&this.UpdatePattern(n),this.isMouseDown=!1,this.onMouseDownPosition=new D.vec3,this.onMouseDownTheta=0,this.onMouseDownPhi=0,this.userControllingStep=!1,this.currentStep=0,this.animationSpeed=a,this.isPlaying=!0,this.renderer.setSize(s,i),this.renderer.domElement.addEventListener("mousemove",function(t){o.onDocumentMouseMove(t)},!1),this.renderer.domElement.addEventListener("mousedown",function(t){o.onDocumentMouseDown(t)},!1),this.renderer.domElement.addEventListener("mouseup",function(t){o.onDocumentMouseUp(t)},!1),this.renderer.domElement.addEventListener("wheel",function(t){o.onDocumentMouseWheel(t)},!1),this.renderer.domElement.addEventListener("touchmove",function(t){o.onDocumentTouchMove(t)},!1),this.renderer.domElement.addEventListener("touchstart",function(t){o.onDocumentTouchStart(t)},!1),this.renderer.domElement.addEventListener("touchmove",function(t){o.onDocumentTouchEnd(t)},!1),e.append(this.renderer.domElement),this.animate()}return Object(c.a)(t,[{key:"UpdateStep",value:function(t){this.currentStep=Math.floor(this.pattern.States.length*this.pattern.Simulation.NumStepsPerBeat*t),this.userControllingStep=!0}},{key:"UpdatePattern",value:function(t){if(this.pattern=t,t){var e=t.GetHeighestAndLowestPositionInSimulation();this.positionToLookAt.y=e[0]-(e[0]-e[1])/2,this.updateCamera()}}},{key:"Resize",value:function(t,e){this.renderer.setSize(t,e),this.camera.aspect=t/e,this.camera.updateProjectionMatrix()}},{key:"onDocumentMouseDown",value:function(t){this.isMouseDown=!0,this.onMouseDownTheta=this.camTheta,this.onMouseDownPhi=this.camPhi,this.onMouseDownPosition.x=t.clientX,this.onMouseDownPosition.y=t.clientY}},{key:"onDocumentTouchStart",value:function(t){this.isMouseDown=!0,this.onMouseDownTheta=this.camTheta,this.onMouseDownPhi=this.camPhi,this.onMouseDownPosition.x=t.touches[0].clientX,this.onMouseDownPosition.y=t.touches[0].clientY}},{key:"onMove",value:function(t,e){if(this.isMouseDown){this.camTheta=-.01*(t-this.onMouseDownPosition.x)+this.onMouseDownTheta;var n=.01*(e-this.onMouseDownPosition.y)+this.onMouseDownPhi;n<Math.PI/2&&n>-Math.PI/2&&(this.camPhi=n),this.updateCamera()}}},{key:"onDocumentMouseMove",value:function(t){t.preventDefault(),this.onMove(t.clientX,t.clientY)}},{key:"onDocumentTouchMove",value:function(t){t.preventDefault(),this.onMove(t.touches[0].clientX,t.touches[0].clientY)}},{key:"onDocumentMouseUp",value:function(t){t.preventDefault(),this.isMouseDown=!1}},{key:"onDocumentTouchEnd",value:function(t){t.preventDefault(),this.isMouseDown=!1}},{key:"onDocumentMouseWheel",value:function(t){this.camRadius+=.05*t.deltaY,this.updateCamera()}},{key:"updateCamera",value:function(){this.camera.position.x=this.camRadius*Math.sin(this.camTheta)*Math.cos(this.camPhi),this.camera.position.y=this.camRadius*Math.sin(this.camPhi)+this.positionToLookAt.y,this.camera.position.z=this.camRadius*Math.cos(this.camTheta)*Math.cos(this.camPhi),this.camera.lookAt(this.positionToLookAt.x,this.positionToLookAt.y,this.positionToLookAt.z)}},{key:"animate",value:function(){var t=this;if(this.pattern&&this.pattern.Simulation&&(this.isPlaying||this.userControllingStep)){if(!this.userControllingStep){var e=((new Date).getTime()-this.startTime)%(this.pattern.States.length*this.pattern.Simulation.BeatDuration*1e3/this.animationSpeed);this.currentStep=Math.floor(e/(this.pattern.States.length*this.pattern.Simulation.BeatDuration*1e3/this.animationSpeed)*(this.pattern.Simulation.NumStepsPerBeat*this.pattern.States.length))}for(;this.pattern.Props.length<this.propMeshes.length;){var n=this.propMeshes.pop();this.scene.remove(n)}for(;this.pattern.Props.length>this.propMeshes.length;){var s=new ht.l(.05,40),i=new ht.f({color:65280}),a=new ht.e(s,i);this.propMeshes.push(a),this.scene.add(a)}for(this.propMeshes.forEach(function(e,n){var s=t.pattern.Simulation.Props[n].Positions[t.currentStep];e.position.set(s.x,s.y,s.z)});this.pattern.Simulation.Jugglers.length>this.jugglerMeshes.length;)this.addJugglerMeshes();this.jugglerMeshes.forEach(function(e,n){var s=t.pattern.Simulation.Jugglers[n];e.BodyMesh.position.set(-.25*Math.sin(s.BodyRotations[t.currentStep]),1.225,.25*Math.cos(s.BodyRotations[t.currentStep])),e.BodyMesh.position.add(t.vec3ToTHREEVector3(s.BodyPositions[t.currentStep])),e.HeadMesh.position.set(-.25*Math.sin(s.BodyRotations[t.currentStep]),1.595,.25*Math.cos(s.BodyRotations[t.currentStep])),e.HeadMesh.position.add(t.vec3ToTHREEVector3(s.BodyPositions[t.currentStep]));var i=new ht.m(-.225*Math.cos(s.BodyRotations[t.currentStep])-.25*Math.sin(s.BodyRotations[t.currentStep]),1.425,-.225*Math.sin(s.BodyRotations[t.currentStep])+.25*Math.cos(s.BodyRotations[t.currentStep]));i.add(t.vec3ToTHREEVector3(s.BodyPositions[t.currentStep]));var a=new ht.m(.225*Math.cos(s.BodyRotations[t.currentStep])-.25*Math.sin(s.BodyRotations[t.currentStep]),1.425,.225*Math.sin(s.BodyRotations[t.currentStep])+.25*Math.cos(s.BodyRotations[t.currentStep]));a.add(t.vec3ToTHREEVector3(s.BodyPositions[t.currentStep]));var o=t.vec3ToTHREEVector3(s.LeftHandPositions[t.currentStep]),r=t.vec3ToTHREEVector3(s.RightHandPositions[t.currentStep]),d=t.vec3ToTHREEVector3(s.LeftElbowPositions[t.currentStep]),h=t.vec3ToTHREEVector3(s.RightElbowPositions[t.currentStep]);e.LeftHandMesh.position.copy(o),e.RightHandMesh.position.copy(r),e.LeftElbowMesh.position.copy(d),e.RightElbowMesh.position.copy(h),e.LeftShoulderMesh.position.copy(i),e.RightShoulderMesh.position.copy(a),t.positionAndRotateArm(d,i,o,e.LeftBicepMesh,e.LeftForearmMesh,e.LeftWristMesh),t.positionAndRotateArm(h,a,r,e.RightBicepMesh,e.RightForearmMesh,e.RightWristMesh);var u=new ht.i;u.setFromUnitVectors(new ht.m(0,1,0),t.vec3ToTHREEVector3(s.LeftHandDirections[t.currentStep])),e.LeftHandMesh.setRotationFromQuaternion(u),u.setFromUnitVectors(new ht.m(0,1,0),t.vec3ToTHREEVector3(s.RightHandDirections[t.currentStep])),e.RightHandMesh.setRotationFromQuaternion(u)})}requestAnimationFrame(function(){return t.animate()}),this.renderer.render(this.scene,this.camera)}},{key:"vec3ToTHREEVector3",value:function(t){return new ht.m(t.x,t.y,t.z)}},{key:"positionAndRotateArm",value:function(t,e,n,s,i,a){var o=(new ht.m).subVectors(t,e),r=new ht.a(o.clone().normalize(),e);s.rotation.setFromVector3(r.rotation.toVector3());var d=(new ht.m).addVectors(e,o.multiplyScalar(.5));s.position.copy(d),o=(new ht.m).subVectors(t,n),r=new ht.a(o.clone().normalize(),n),i.rotation.setFromVector3(r.rotation.toVector3()),d=(new ht.m).addVectors(n,o.multiplyScalar(.5)).add(o.clone().normalize().multiplyScalar(.04)),i.position.copy(d),d=n.clone().add(o.clone().normalize().multiplyScalar(.08)),a.position.copy(d)}},{key:"getHandMesh",value:function(){var t=new ht.k(.06,20,20,0,2*Math.PI,Math.PI/2,Math.PI),e=new ht.g({color:"grey",side:ht.c,flatShading:!0});return new ht.e(t,e)}},{key:"getJointMesh",value:function(t){var e=new ht.l(t,20);return new ht.e(e,ut)}},{key:"getArmCylinder",value:function(t,e,n){var s=new ht.b(e,t,n,20,20);return new ht.e(s,ut)}},{key:"addJugglerMeshes",value:function(){var t={LeftHandMesh:this.getHandMesh(),RightHandMesh:this.getHandMesh(),LeftElbowMesh:this.getJointMesh(.04),RightElbowMesh:this.getJointMesh(.04),LeftShoulderMesh:this.getJointMesh(.025),RightShoulderMesh:this.getJointMesh(.025),LeftWristMesh:this.getJointMesh(.02),RightWristMesh:this.getJointMesh(.02),LeftBicepMesh:this.getArmCylinder(.025,.04,.3),LeftForearmMesh:this.getArmCylinder(.02,.04,.21),RightBicepMesh:this.getArmCylinder(.025,.04,.3),RightForearmMesh:this.getArmCylinder(.02,.04,.21),BodyMesh:new ht.e(new ht.b(.15,.05,.4,20,20,!1),ut),HeadMesh:new ht.e(new ht.k(.1,20,20),ut)};this.jugglerMeshes.push(t),this.scene.add(t.LeftElbowMesh),this.scene.add(t.LeftHandMesh),this.scene.add(t.LeftShoulderMesh),this.scene.add(t.RightElbowMesh),this.scene.add(t.RightHandMesh),this.scene.add(t.RightShoulderMesh),this.scene.add(t.LeftBicepMesh),this.scene.add(t.LeftForearmMesh),this.scene.add(t.RightBicepMesh),this.scene.add(t.RightForearmMesh),this.scene.add(t.LeftWristMesh),this.scene.add(t.RightWristMesh),this.scene.add(t.BodyMesh),this.scene.add(t.HeadMesh)}}]),t}(),ct=n(151),gt=n(149),pt=function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(g.a)(this,Object(p.a)(e).call(this,t))).CanvasContainerRef=void 0,n.jugglingScene=void 0,n.CanvasContainerRef=null,n.state={debugInfo:null,userControllingStep:!1,isPlaying:!0,animationSpeed:.5},n.userUpdateStep=n.userUpdateStep.bind(Object(f.a)(n)),n.play=n.play.bind(Object(f.a)(n)),n.pause=n.pause.bind(Object(f.a)(n)),n}return Object(v.a)(e,t),Object(c.a)(e,[{key:"play",value:function(){this.jugglingScene&&(this.jugglingScene.isPlaying=!0,this.jugglingScene.userControllingStep=!1,this.setState({isPlaying:!0,userControllingStep:!1}))}},{key:"pause",value:function(){this.jugglingScene&&(this.jugglingScene.isPlaying=!1,this.setState({isPlaying:!1}))}},{key:"userUpdateStep",value:function(t){this.jugglingScene&&(this.jugglingScene.UpdateStep(t),this.setState({debugInfo:{step:this.jugglingScene.currentStep},userControllingStep:!0}))}},{key:"componentDidUpdate",value:function(){this.jugglingScene&&this.jugglingScene.pattern!==this.props.pattern&&(this.jugglingScene.userControllingStep=!1,this.jugglingScene.isPlaying=!0,this.setState({userControllingStep:!1,debugInfo:null,isPlaying:!0}),this.jugglingScene.UpdatePattern(this.props.pattern))}},{key:"componentDidMount",value:function(){var t=this,e=this.CanvasContainerRef.offsetWidth,n=window.innerHeight-32;this.jugglingScene=new lt(this.CanvasContainerRef,this.props.pattern,e,n,this.state.animationSpeed),window.jugglingScene=this.jugglingScene,window.addEventListener("resize",function(){if(t.CanvasContainerRef){var e=t.CanvasContainerRef.offsetWidth,n=window.innerHeight-32;t.jugglingScene&&t.jugglingScene.Resize(e,n)}})}},{key:"render",value:function(){var t,e=this,n=d.a.createElement("div",null);return this.state.debugInfo&&(n=d.a.createElement("div",null,this.state.debugInfo.step)),t=this.state.isPlaying&&!this.state.userControllingStep?d.a.createElement(ct.a,{iconProps:{iconName:"Pause"},onClick:this.pause}):d.a.createElement(ct.a,{iconProps:{iconName:"Play"},onClick:this.play}),d.a.createElement("div",null,d.a.createElement("div",{className:"debug-info"},n),d.a.createElement("div",{ref:function(t){e.CanvasContainerRef=t}}),d.a.createElement($.a,{horizontal:!0},t,d.a.createElement(gt.a,{className:"viewport-slider",min:0,max:.99,step:.005,showValue:!1,onChange:function(t){return e.userUpdateStep(t)}})))}}]),e}(r.Component),ft=n(153),vt=function(t){function e(t){var n;Object(l.a)(this,e);return(n=Object(g.a)(this,Object(p.a)(e).call(this,t))).state={Siteswaps:[],Input:it.safeDump({numProps:3,minPeriod:1,maxPeriod:5,includeMultiplex:!1,includeExcited:!0,maxSearches:1e3,maxSiteswaps:100,sync:!1,exclude:[]})},n.onRenderCell=n.onRenderCell.bind(Object(f.a)(n)),n.findSiteswaps=n.findSiteswaps.bind(Object(f.a)(n)),n.updateInput=n.updateInput.bind(Object(f.a)(n)),n}return Object(v.a)(e,t),Object(c.a)(e,[{key:"findSiteswaps",value:function(){var t;try{t=it.safeLoad(this.state.Input)}catch(n){}if(t){var e=rt(t);this.setState({Siteswaps:e})}}},{key:"onRenderCell",value:function(t,e){return d.a.createElement("div",{id:e.toString()},t)}},{key:"updateInput",value:function(t){this.setState({Input:t.target.value})}},{key:"render",value:function(){window.innerHeight;return d.a.createElement($.a,null,d.a.createElement(tt.a,{className:"panel-main-button",text:"Find Siteswaps",onClick:this.findSiteswaps}),d.a.createElement(nt.a,null,"Search Settings"),d.a.createElement(st.a,{value:this.state.Input,multiline:!0,onChange:this.updateInput,autoAdjustHeight:!0}),d.a.createElement(ft.a,{className:"siteswap-list",items:this.state.Siteswaps,onRenderCell:this.onRenderCell}))}}]),e}(r.Component),mt={siteswap:"3",beatDuration:.24,dwellPath:"(30)(10)",dwellRatio:.8},Pt=function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(g.a)(this,Object(p.a)(e).call(this,t))).state={pattern:new V(new A(mt.siteswap),Y(mt.dwellPath),mt.dwellRatio,0),patternSettings:mt},n.state.pattern.Simulate(100,.24),window.onresize=function(){n.forceUpdate()},n.updatePattern=n.updatePattern.bind(Object(f.a)(n)),n}return Object(v.a)(e,t),Object(c.a)(e,[{key:"updatePattern",value:function(t,e){this.setState({pattern:t,patternSettings:e})}},{key:"render",value:function(){var t=d.a.createElement(dt,{updatePattern:this.updatePattern,patternSettings:this.state.patternSettings}),e=d.a.createElement(vt,null),n=d.a.createElement(pt,{pattern:this.state.pattern});return window.innerWidth>900?d.a.createElement("div",{className:"ms-Grid",dir:"ltr"},d.a.createElement("div",{className:"ms-Grid-row"},d.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md4 ms-lg4"},d.a.createElement(X.a,null,d.a.createElement(Q.a,{headerText:"Pattern",itemIcon:"Settings"},t),d.a.createElement(Q.a,{headerText:"Siteswaps",itemIcon:"Search"},e))),d.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md8 ms-lg8"},n))):d.a.createElement(X.a,null,d.a.createElement(Q.a,{headerText:"Animator",itemIcon:"Video"},n),d.a.createElement(Q.a,{headerText:"Pattern",itemIcon:"Settings"},t),d.a.createElement(Q.a,{headerText:"Siteswaps",itemIcon:"Search"},e))}}]),e}(r.Component),St=n(77);Object(St.a)();var wt=function(){return d.a.createElement(Pt,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(d.a.createElement(wt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},86:function(t,e,n){t.exports=n(119)},91:function(t,e,n){},92:function(t,e,n){}},[[86,1,2]]]);
//# sourceMappingURL=main.d7037ff8.chunk.js.map